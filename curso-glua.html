<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Curso Completo de GLua — De Cero a Desarrollo Avanzado</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;500;600;700;800;900&family=Source+Serif+4:ital,wght@0,300;0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
/* ===== RESET & VARS ===== */
:root {
  --bg-deep: #080a10;
  --bg-primary: #0c0e14;
  --bg-secondary: #11141d;
  --bg-card: #171b28;
  --bg-code: #0d1117;
  --border-dim: #1a1e2e;
  --border-subtle: #222840;
  --text-primary: #dfe3f0;
  --text-secondary: #8891ab;
  --text-muted: #4e5670;
  --accent-blue: #5a8df7;
  --accent-cyan: #4ecdc4;
  --accent-green: #45c088;
  --accent-orange: #e8973f;
  --accent-red: #e85d5d;
  --accent-purple: #a07ae8;
  --accent-yellow: #e8c94b;
  --glow-blue: rgba(90,141,247,0.07);
  --glow-cyan: rgba(78,205,196,0.05);
  --font-display: 'Outfit', sans-serif;
  --font-body: 'Source Serif 4', Georgia, serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
  --sidebar-w: 290px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; scrollbar-width: thin; scrollbar-color: #2a3050 var(--bg-primary); }
body {
  font-family: var(--font-body);
  font-size: 17px; line-height: 1.78;
  color: var(--text-primary);
  background: var(--bg-primary);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* ===== PROGRESS ===== */
.progress {
  position: fixed; top: 0; left: 0; width: 0%;
  height: 3px; z-index: 500;
  background: linear-gradient(90deg, var(--accent-cyan), var(--accent-blue), var(--accent-purple));
  transition: width 80ms linear;
}

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed; top: 0; left: 0;
  width: var(--sidebar-w); height: 100vh;
  background: var(--bg-secondary);
  border-right: 1px solid var(--border-dim);
  overflow-y: auto; z-index: 100;
  padding: 0;
  scrollbar-width: thin;
  scrollbar-color: var(--border-dim) transparent;
  transition: transform .3s cubic-bezier(.4,0,.2,1);
}
.sb-head {
  position: sticky; top: 0;
  background: var(--bg-secondary);
  padding: 24px 22px 18px;
  border-bottom: 1px solid var(--border-dim);
  z-index: 2;
}
.sb-head h1 {
  font-family: var(--font-display);
  font-size: 17px; font-weight: 800;
  letter-spacing: -.02em;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.sb-head small {
  font-family: var(--font-mono);
  font-size: 10.5px; color: var(--text-muted);
  display: block; margin-top: 3px;
}
.sb-nav { padding: 10px 0 24px; }
.sb-nav a {
  display: flex; align-items: baseline; gap: 8px;
  padding: 5px 22px;
  color: var(--text-secondary); text-decoration: none;
  font-family: var(--font-display);
  font-size: 13px; font-weight: 400; line-height: 1.45;
  border-left: 2px solid transparent;
  transition: all .12s ease;
}
.sb-nav a:hover {
  color: var(--text-primary);
  background: var(--glow-blue);
  border-left-color: var(--accent-blue);
}
.sb-nav a .snum {
  font-family: var(--font-mono);
  font-size: 10px; color: var(--text-muted);
  min-width: 18px;
}
.sb-nav a.sub {
  padding-left: 48px;
  font-size: 12px;
  color: var(--text-muted);
}
.sb-nav a.sub:hover { color: var(--text-secondary); }

/* ===== MAIN ===== */
.main {
  margin-left: var(--sidebar-w);
  max-width: 840px;
  padding: 44px 52px 140px;
}

/* ===== HERO ===== */
.hero {
  margin-bottom: 60px; padding: 44px 48px;
  background: linear-gradient(145deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-lg);
  position: relative; overflow: hidden;
}
.hero::before {
  content: ''; position: absolute;
  top: -60%; right: -25%;
  width: 520px; height: 520px;
  background: radial-gradient(circle, rgba(90,141,247,.055) 0%, transparent 70%);
  pointer-events: none;
}
.hero::after {
  content: ''; position: absolute;
  bottom: -50%; left: -15%;
  width: 400px; height: 400px;
  background: radial-gradient(circle, rgba(78,205,196,.035) 0%, transparent 70%);
  pointer-events: none;
}
.hero h1 {
  font-family: var(--font-display);
  font-size: 36px; font-weight: 900;
  letter-spacing: -.03em; line-height: 1.15;
  margin-bottom: 14px; position: relative;
}
.hero .grad {
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue), var(--accent-purple));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.hero .sub {
  font-size: 15.5px; color: var(--text-secondary);
  line-height: 1.6; position: relative; max-width: 600px;
}
.hero .tags {
  display: flex; gap: 10px; flex-wrap: wrap;
  margin-top: 20px; position: relative;
}
.hero .tags span {
  font-family: var(--font-mono); font-size: 11px;
  padding: 3px 12px; border-radius: 20px;
  background: rgba(90,141,247,.08);
  border: 1px solid rgba(90,141,247,.13);
  color: var(--accent-blue);
}
.hero .prereq {
  margin-top: 18px; font-size: 14px;
  color: var(--text-muted); position: relative;
}
.hero .prereq strong { color: var(--text-secondary); }

/* ===== SECTIONS ===== */
.section { margin-bottom: 54px; scroll-margin-top: 20px; }
h2 {
  font-family: var(--font-display);
  font-size: 27px; font-weight: 800;
  letter-spacing: -.02em; color: var(--text-primary);
  margin-bottom: 22px; padding-bottom: 12px;
  border-bottom: 2px solid var(--border-dim);
  display: flex; align-items: center; gap: 12px;
}
h2 .num {
  font-family: var(--font-mono); font-size: 12px; font-weight: 700;
  color: var(--accent-cyan);
  background: rgba(78,205,196,.07);
  border: 1px solid rgba(78,205,196,.13);
  padding: 2px 10px; border-radius: 20px;
  flex-shrink: 0; line-height: 1.6;
}
h3 {
  font-family: var(--font-display);
  font-size: 19px; font-weight: 700;
  color: var(--accent-blue);
  margin: 30px 0 10px;
}
h4 {
  font-family: var(--font-display);
  font-size: 15.5px; font-weight: 600;
  color: var(--accent-orange);
  margin: 22px 0 8px;
}
p { margin-bottom: 13px; }
strong { color: var(--text-primary); font-weight: 600; }
a { color: var(--accent-blue); text-decoration: none; border-bottom: 1px solid rgba(90,141,247,.25); transition: border-color .15s; }
a:hover { border-bottom-color: var(--accent-blue); }
ul, ol { margin: 10px 0 14px 22px; color: var(--text-secondary); }
li { margin-bottom: 3px; }
hr { border: none; height: 1px; background: var(--border-dim); margin: 44px 0; }

/* ===== CODE ===== */
.highlight {
  background: var(--bg-code) !important;
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  padding: 18px 22px;
  margin: 14px 0 18px;
  overflow-x: auto;
  font-size: 13.5px; line-height: 1.65;
}
.highlight pre {
  background: transparent !important;
  border: none !important;
  padding: 0 !important; margin: 0 !important;
  overflow-x: auto;
}
.highlight code {
  font-family: var(--font-mono) !important;
  font-size: 13.5px;
  background: transparent !important;
}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #49483e }
.highlight { background: #272822; color: #F8F8F2 }
.highlight .c { color: #959077 } /* Comment */
.highlight .err { color: #ED007E; background-color: #1E0010 } /* Error */
.highlight .esc { color: #F8F8F2 } /* Escape */
.highlight .g { color: #F8F8F2 } /* Generic */
.highlight .k { color: #66D9EF } /* Keyword */
.highlight .l { color: #AE81FF } /* Literal */
.highlight .n { color: #F8F8F2 } /* Name */
.highlight .o { color: #FF4689 } /* Operator */
.highlight .x { color: #F8F8F2 } /* Other */
.highlight .p { color: #F8F8F2 } /* Punctuation */
.highlight .ch { color: #959077 } /* Comment.Hashbang */
.highlight .cm { color: #959077 } /* Comment.Multiline */
.highlight .cp { color: #959077 } /* Comment.Preproc */
.highlight .cpf { color: #959077 } /* Comment.PreprocFile */
.highlight .c1 { color: #959077 } /* Comment.Single */
.highlight .cs { color: #959077 } /* Comment.Special */
.highlight .gd { color: #FF4689 } /* Generic.Deleted */
.highlight .ge { color: #F8F8F2; font-style: italic } /* Generic.Emph */
.highlight .ges { color: #F8F8F2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #F8F8F2 } /* Generic.Error */
.highlight .gh { color: #F8F8F2 } /* Generic.Heading */
.highlight .gi { color: #A6E22E } /* Generic.Inserted */
.highlight .go { color: #66D9EF } /* Generic.Output */
.highlight .gp { color: #FF4689; font-weight: bold } /* Generic.Prompt */
.highlight .gs { color: #F8F8F2; font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #959077 } /* Generic.Subheading */
.highlight .gt { color: #F8F8F2 } /* Generic.Traceback */
.highlight .kc { color: #66D9EF } /* Keyword.Constant */
.highlight .kd { color: #66D9EF } /* Keyword.Declaration */
.highlight .kn { color: #FF4689 } /* Keyword.Namespace */
.highlight .kp { color: #66D9EF } /* Keyword.Pseudo */
.highlight .kr { color: #66D9EF } /* Keyword.Reserved */
.highlight .kt { color: #66D9EF } /* Keyword.Type */
.highlight .ld { color: #E6DB74 } /* Literal.Date */
.highlight .m { color: #AE81FF } /* Literal.Number */
.highlight .s { color: #E6DB74 } /* Literal.String */
.highlight .na { color: #A6E22E } /* Name.Attribute */
.highlight .nb { color: #F8F8F2 } /* Name.Builtin */
.highlight .nc { color: #A6E22E } /* Name.Class */
.highlight .no { color: #66D9EF } /* Name.Constant */
.highlight .nd { color: #A6E22E } /* Name.Decorator */
.highlight .ni { color: #F8F8F2 } /* Name.Entity */
.highlight .ne { color: #A6E22E } /* Name.Exception */
.highlight .nf { color: #A6E22E } /* Name.Function */
.highlight .nl { color: #F8F8F2 } /* Name.Label */
.highlight .nn { color: #F8F8F2 } /* Name.Namespace */
.highlight .nx { color: #A6E22E } /* Name.Other */
.highlight .py { color: #F8F8F2 } /* Name.Property */
.highlight .nt { color: #FF4689 } /* Name.Tag */
.highlight .nv { color: #F8F8F2 } /* Name.Variable */
.highlight .ow { color: #FF4689 } /* Operator.Word */
.highlight .pm { color: #F8F8F2 } /* Punctuation.Marker */
.highlight .w { color: #F8F8F2 } /* Text.Whitespace */
.highlight .mb { color: #AE81FF } /* Literal.Number.Bin */
.highlight .mf { color: #AE81FF } /* Literal.Number.Float */
.highlight .mh { color: #AE81FF } /* Literal.Number.Hex */
.highlight .mi { color: #AE81FF } /* Literal.Number.Integer */
.highlight .mo { color: #AE81FF } /* Literal.Number.Oct */
.highlight .sa { color: #E6DB74 } /* Literal.String.Affix */
.highlight .sb { color: #E6DB74 } /* Literal.String.Backtick */
.highlight .sc { color: #E6DB74 } /* Literal.String.Char */
.highlight .dl { color: #E6DB74 } /* Literal.String.Delimiter */
.highlight .sd { color: #E6DB74 } /* Literal.String.Doc */
.highlight .s2 { color: #E6DB74 } /* Literal.String.Double */
.highlight .se { color: #AE81FF } /* Literal.String.Escape */
.highlight .sh { color: #E6DB74 } /* Literal.String.Heredoc */
.highlight .si { color: #E6DB74 } /* Literal.String.Interpol */
.highlight .sx { color: #E6DB74 } /* Literal.String.Other */
.highlight .sr { color: #E6DB74 } /* Literal.String.Regex */
.highlight .s1 { color: #E6DB74 } /* Literal.String.Single */
.highlight .ss { color: #E6DB74 } /* Literal.String.Symbol */
.highlight .bp { color: #F8F8F2 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #A6E22E } /* Name.Function.Magic */
.highlight .vc { color: #F8F8F2 } /* Name.Variable.Class */
.highlight .vg { color: #F8F8F2 } /* Name.Variable.Global */
.highlight .vi { color: #F8F8F2 } /* Name.Variable.Instance */
.highlight .vm { color: #F8F8F2 } /* Name.Variable.Magic */
.highlight .il { color: #AE81FF } /* Literal.Number.Integer.Long */

code {
  font-family: var(--font-mono); font-size: 13.5px;
}
p > code, li > code, td > code, a > code, strong > code,
h3 > code, h4 > code {
  background: rgba(90,141,247,.07);
  border: 1px solid rgba(90,141,247,.09);
  color: var(--accent-cyan);
  padding: 1px 6px; border-radius: 4px;
  font-size: .86em;
}

/* ===== TABLES ===== */
table {
  width: 100%; border-collapse: collapse;
  margin: 14px 0 18px; font-size: 14px;
}
th {
  font-family: var(--font-display); font-weight: 600;
  text-align: left; padding: 9px 14px;
  background: var(--bg-card);
  border: 1px solid var(--border-dim);
  color: var(--accent-blue); font-size: 13px;
}
td {
  padding: 7px 14px;
  border: 1px solid var(--border-dim);
  color: var(--text-secondary);
}
tr:hover td { background: var(--glow-blue); }

/* ===== MOBILE ===== */
.mob-btn {
  display: none; position: fixed;
  top: 10px; left: 10px; z-index: 200;
  width: 38px; height: 38px;
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-sm);
  color: var(--text-primary); font-size: 19px;
  cursor: pointer; align-items: center; justify-content: center;
  line-height: 1;
}
@media (max-width: 900px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); box-shadow: 4px 0 40px rgba(0,0,0,.6); }
  .main { margin-left: 0; padding: 28px 18px 80px; }
  .hero { padding: 24px; }
  .hero h1 { font-size: 24px; }
  .mob-btn { display: flex; }
}

/* ===== BACK-TOP ===== */
.btt {
  position: fixed; bottom: 22px; right: 22px;
  width: 42px; height: 42px;
  background: var(--bg-card);
  border: 1px solid var(--border-subtle);
  border-radius: 50%; color: var(--accent-blue);
  font-size: 17px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; transform: translateY(8px);
  transition: all .2s ease; z-index: 150;
}
.btt.show { opacity: 1; transform: translateY(0); }
.btt:hover { background: var(--accent-blue); color: var(--bg-primary); }

/* ===== BLOCKQUOTE ===== */
blockquote {
  border-left: 3px solid var(--accent-cyan);
  background: rgba(78,205,196,.04);
  padding: 12px 18px;
  margin: 14px 0 18px;
  border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
  color: var(--text-secondary);
  font-size: 15px;
}
blockquote strong { color: var(--text-primary); }
</style>
</head>
<body>

<div class="progress" id="prog"></div>
<button class="mob-btn" id="mobBtn" onclick="document.getElementById('sb').classList.toggle('open')">☰</button>

<aside class="sidebar" id="sb">
  <div class="sb-head">
    <h1>Curso GLua</h1>
    <small>v2026 · wiki.facepunch.com/gmod</small>
  </div>
  <nav class="sb-nav">
    <a href="#1-introduccion-que-es-glua"><span class="snum">01</span> Introducción: ¿Qué es GLua?</a>
    <a href="#2-el-entorno-de-desarrollo"><span class="snum">02</span> El Entorno de Desarrollo</a>
    <a href="#3-los-tres-reinos-realms"><span class="snum">03</span> Los Tres Reinos (Realms)</a>
    <a href="#31-realm-del-servidor-server"><span class="snum">03</span> 1. Realm del Servidor (Server)</a>
    <a href="#32-realm-del-cliente-client"><span class="snum">03</span> 2. Realm del Cliente (Client)</a>
    <a href="#33-realm-del-menu-menu"><span class="snum">03</span> 3. Realm del Menú (Menu)</a>
    <a href="#34-shared-no-es-un-realm-real"><span class="snum">03</span> 4. "Shared" — No es un Realm Real</a>
    <a href="#4-estructura-de-archivos-y-addons"><span class="snum">04</span> Estructura de Archivos y Addons</a>
    <a href="#41-estructura-de-un-addon"><span class="snum">04</span> 1. Estructura de un Addon</a>
    <a href="#42-directorios-especiales-de-lua"><span class="snum">04</span> 2. Directorios Especiales de Lua</a>
    <a href="#43-el-archivo-addonjson"><span class="snum">04</span> 3. El archivo addon.json</a>
    <a href="#5-el-sistema-de-inclusion-de-archivos"><span class="snum">05</span> El Sistema de Inclusión de Archivos</a>
    <a href="#51-include-y-addcsluafile"><span class="snum">05</span> 1. include() y AddCSLuaFile()</a>
    <a href="#52-patron-de-carga-tipico"><span class="snum">05</span> 2. Patrón de Carga Típico</a>
    <a href="#53-convencion-de-nombres-de-archivos"><span class="snum">05</span> 3. Convención de Nombres de Archivos</a>
    <a href="#54-orden-de-carga"><span class="snum">05</span> 4. Orden de Carga</a>
    <a href="#6-hooks-el-corazon-de-glua"><span class="snum">06</span> Hooks: El Corazón de GLua</a>
    <a href="#61-concepto"><span class="snum">06</span> 1. Concepto</a>
    <a href="#62-hookadd"><span class="snum">06</span> 2. hook.Add</a>
    <a href="#63-hookremove"><span class="snum">06</span> 3. hook.Remove</a>
    <a href="#64-hookrun-y-hookcall"><span class="snum">06</span> 4. hook.Run y hook.Call</a>
    <a href="#65-valores-de-retorno-en-hooks"><span class="snum">06</span> 5. Valores de Retorno en Hooks</a>
    <a href="#66-hooks-fundamentales"><span class="snum">06</span> 6. Hooks Fundamentales</a>
    <a href="#7-timers-control-del-tiempo"><span class="snum">07</span> Timers: Control del Tiempo</a>
    <a href="#71-timersimple"><span class="snum">07</span> 1. timer.Simple</a>
    <a href="#72-timercreate"><span class="snum">07</span> 2. timer.Create</a>
    <a href="#73-funciones-de-control"><span class="snum">07</span> 3. Funciones de Control</a>
    <a href="#8-comandos-de-consola-y-convars"><span class="snum">08</span> Comandos de Consola y ConVars</a>
    <a href="#81-comandos-de-consola"><span class="snum">08</span> 1. Comandos de Consola</a>
    <a href="#82-convars-variables-de-consola"><span class="snum">08</span> 2. ConVars (Variables de Consola)</a>
    <a href="#9-entidades-el-sistema-central-del-motor"><span class="snum">09</span> Entidades: El Sistema Central del Motor</a>
    <a href="#91-obtener-entidades"><span class="snum">09</span> 1. Obtener Entidades</a>
    <a href="#92-metodos-fundamentales-de-entity"><span class="snum">09</span> 2. Métodos Fundamentales de Entity</a>
    <a href="#93-crear-entidades-server-side"><span class="snum">09</span> 3. Crear Entidades (Server-side)</a>
    <a href="#94-traces-raycast"><span class="snum">09</span> 4. Traces (Raycast)</a>
    <a href="#10-el-jugador-player"><span class="snum">10</span> El Jugador (Player)</a>
    <a href="#101-obtener-jugadores"><span class="snum">10</span> 1. Obtener Jugadores</a>
    <a href="#102-metodos-del-jugador"><span class="snum">10</span> 2. Métodos del Jugador</a>
    <a href="#103-ejemplo-comando-de-informacion"><span class="snum">10</span> 3. Ejemplo: Comando de Información</a>
    <a href="#11-networking-la-libreria-net"><span class="snum">11</span> Networking: La Librería Net</a>
    <a href="#111-flujo-de-un-mensaje-net"><span class="snum">11</span> 1. Flujo de un Mensaje Net</a>
    <a href="#112-registrar-mensajes-server"><span class="snum">11</span> 2. Registrar Mensajes (Server)</a>
    <a href="#113-funciones-de-escritura-y-lectura"><span class="snum">11</span> 3. Funciones de Escritura y Lectura</a>
    <a href="#114-enviar-servidor-cliente"><span class="snum">11</span> 4. Enviar: Servidor → Cliente</a>
    <a href="#115-enviar-cliente-servidor"><span class="snum">11</span> 5. Enviar: Cliente → Servidor</a>
    <a href="#116-recibir-mensajes"><span class="snum">11</span> 6. Recibir Mensajes</a>
    <a href="#117-ejemplo-completo-sistema-de-compra"><span class="snum">11</span> 7. Ejemplo Completo: Sistema de Compra</a>
    <a href="#12-variables-de-red-nwvars-nw2vars-y-networkvar"><span class="snum">12</span> Variables de Red (NWVars, NW2Vars y NetworkVar)</a>
    <a href="#121-nwvars-legacy"><span class="snum">12</span> 1. NWVars — Legacy</a>
    <a href="#122-nw2vars-sistema-mejorado"><span class="snum">12</span> 2. NW2Vars — Sistema Mejorado</a>
    <a href="#123-networkvar-entitynetworkvar-setupdatatables"><span class="snum">12</span> 3. NetworkVar (Entity:NetworkVar / SetupDataTables)</a>
    <a href="#124-cuando-usar-cada-uno"><span class="snum">12</span> 4. ¿Cuándo usar cada uno?</a>
    <a href="#13-almacenamiento-de-datos-file-y-sql"><span class="snum">13</span> Almacenamiento de Datos: file y sql</a>
    <a href="#131-la-libreria-file"><span class="snum">13</span> 1. La Librería file</a>
    <a href="#132-guardar-y-cargar-con-json"><span class="snum">13</span> 2. Guardar y Cargar con JSON</a>
    <a href="#133-sqlite-sql-library"><span class="snum">13</span> 3. SQLite (sql library)</a>
    <a href="#14-http-comunicacion-con-el-exterior"><span class="snum">14</span> HTTP: Comunicación con el Exterior</a>
    <a href="#141-la-funcion-http"><span class="snum">14</span> 1. La Función HTTP()</a>
    <a href="#142-wrappers-simplificados"><span class="snum">14</span> 2. Wrappers Simplificados</a>
    <a href="#143-ejemplo-webhook-de-discord"><span class="snum">14</span> 3. Ejemplo: Webhook de Discord</a>
    <a href="#15-renderizado-2d-surface-y-draw"><span class="snum">15</span> Renderizado 2D: surface y draw</a>
    <a href="#151-la-libreria-surface"><span class="snum">15</span> 1. La Librería surface</a>
    <a href="#152-la-libreria-draw"><span class="snum">15</span> 2. La Librería draw</a>
    <a href="#16-fuentes-personalizadas"><span class="snum">16</span> Fuentes Personalizadas</a>
    <a href="#161-crear-una-fuente"><span class="snum">16</span> 1. Crear una Fuente</a>
    <a href="#162-fuentes-ttf-personalizadas"><span class="snum">16</span> 2. Fuentes .ttf Personalizadas</a>
    <a href="#163-fuentes-por-defecto-de-gmod"><span class="snum">16</span> 3. Fuentes por Defecto de GMod</a>
    <a href="#17-el-hud-interfaz-de-usuario-en-pantalla"><span class="snum">17</span> El HUD: Interfaz de Usuario en Pantalla</a>
    <a href="#171-hud-personalizado"><span class="snum">17</span> 1. HUD Personalizado</a>
    <a href="#172-ocultar-el-hud-por-defecto"><span class="snum">17</span> 2. Ocultar el HUD por Defecto</a>
    <a href="#173-escalado-responsivo"><span class="snum">17</span> 3. Escalado Responsivo</a>
    <a href="#18-vgui-y-derma-interfaces-interactivas"><span class="snum">18</span> VGUI y Derma: Interfaces Interactivas</a>
    <a href="#181-panel-basico-dframe"><span class="snum">18</span> 1. Panel Básico: DFrame</a>
    <a href="#182-paneles-derma-comunes"><span class="snum">18</span> 2. Paneles Derma Comunes</a>
    <a href="#183-docking-acoplamiento"><span class="snum">18</span> 3. Docking (Acoplamiento)</a>
    <a href="#184-paint-personalizar-la-apariencia"><span class="snum">18</span> 4. Paint: Personalizar la Apariencia</a>
    <a href="#185-crear-paneles-personalizados-vgui-register"><span class="snum">18</span> 5. Crear Paneles Personalizados (VGUI Register)</a>
    <a href="#19-renderizado-3d-y-la-libreria-cam"><span class="snum">19</span> Renderizado 3D y la Librería cam</a>
    <a href="#191-camstart3d2d"><span class="snum">19</span> 1. cam.Start3D2D</a>
    <a href="#192-3d2d-en-una-entidad-sent"><span class="snum">19</span> 2. 3D2D en una Entidad (SENT)</a>
    <a href="#20-scripted-weapons-sweps"><span class="snum">20</span> Scripted Weapons (SWEPs)</a>
    <a href="#201-estructura-de-archivos"><span class="snum">20</span> 1. Estructura de Archivos</a>
    <a href="#202-swep-basica-completa"><span class="snum">20</span> 2. SWEP Básica Completa</a>
    <a href="#203-hooks-de-swep-importantes"><span class="snum">20</span> 3. Hooks de SWEP Importantes</a>
    <a href="#21-scripted-entities-sents"><span class="snum">21</span> Scripted Entities (SENTs)</a>
    <a href="#211-estructura"><span class="snum">21</span> 1. Estructura</a>
    <a href="#212-sent-completa-caja-de-suministros"><span class="snum">21</span> 2. SENT Completa: Caja de Suministros</a>
    <a href="#22-creacion-de-gamemodes"><span class="snum">22</span> Creación de Gamemodes</a>
    <a href="#221-estructura"><span class="snum">22</span> 1. Estructura</a>
    <a href="#222-archivos-basicos"><span class="snum">22</span> 2. Archivos Básicos</a>
    <a href="#223-hooks-de-gamemode"><span class="snum">22</span> 3. Hooks de Gamemode</a>
    <a href="#23-metatables-y-oop-en-glua"><span class="snum">23</span> Metatables y OOP en GLua</a>
    <a href="#231-metatables-de-entidades"><span class="snum">23</span> 1. Metatables de Entidades</a>
    <a href="#232-crear-objetos-con-oop"><span class="snum">23</span> 2. Crear Objetos con OOP</a>
    <a href="#24-optimizacion-y-buenas-practicas"><span class="snum">24</span> Optimización y Buenas Prácticas</a>
    <a href="#241-evitar-operaciones-costosas-en-thinktick"><span class="snum">24</span> 1. Evitar Operaciones Costosas en Think/Tick</a>
    <a href="#242-cachear-valores"><span class="snum">24</span> 2. Cachear Valores</a>
    <a href="#243-localizar-funciones-globales"><span class="snum">24</span> 3. Localizar Funciones Globales</a>
    <a href="#244-usar-isvalid-correctamente"><span class="snum">24</span> 4. Usar IsValid Correctamente</a>
    <a href="#245-nombres-unicos-para-hooks"><span class="snum">24</span> 5. Nombres Únicos para Hooks</a>
    <a href="#25-seguridad-y-anti-exploit"><span class="snum">25</span> Seguridad y Anti-Exploit</a>
    <a href="#251-regla-de-oro-nunca-confies-en-el-cliente"><span class="snum">25</span> 1. Regla de Oro: Nunca Confíes en el Cliente</a>
    <a href="#252-rate-limiting"><span class="snum">25</span> 2. Rate Limiting</a>
    <a href="#253-validar-datos"><span class="snum">25</span> 3. Validar Datos</a>
    <a href="#254-verificar-permisos"><span class="snum">25</span> 4. Verificar Permisos</a>
    <a href="#26-debugging-y-manejo-de-errores"><span class="snum">26</span> Debugging y Manejo de Errores</a>
    <a href="#261-funciones-de-debug"><span class="snum">26</span> 1. Funciones de Debug</a>
    <a href="#262-manejo-de-errores"><span class="snum">26</span> 2. Manejo de Errores</a>
    <a href="#263-la-libreria-debug"><span class="snum">26</span> 3. La Librería debug</a>
    <a href="#27-publicacion-en-el-workshop"><span class="snum">27</span> Publicación en el Workshop</a>
    <a href="#271-crear-y-subir"><span class="snum">27</span> 1. Crear y Subir</a>
    <a href="#28-proyecto-final-addon-completo"><span class="snum">28</span> Proyecto Final: Addon Completo</a>
  </nav>
</aside>

<main class="main">

<div class="hero">
  <h1>Curso Completo de <span class="grad">GLua</span></h1>
  <p class="sub">De cero a desarrollo avanzado de addons para Garry's Mod. Curso estructurado y actualizado con la documentación oficial de la wiki de Garry's Mod.</p>
  <div class="tags">
    <span>Lua 5.1 + LuaJIT</span>
    <span>Source Engine</span>
    <span>28 Secciones</span>
    <span>2026</span>
  </div>
  <p class="prereq"><strong>Requisito previo:</strong> Este curso asume que ya conocés la sintaxis de Lua 5.1 (variables, funciones, tablas, loops, condicionales, metatables). Nos enfocamos exclusivamente en <strong>cómo Lua funciona dentro de Garry's Mod</strong>.</p>
</div>

<h1 id="curso-completo-de-glua-de-cero-a-desarrollo-avanzado-de-addons">Curso Completo de GLua — De Cero a Desarrollo Avanzado de Addons</h1>
<blockquote>
<p><strong>Versión:</strong> 2026 · <strong>Referencia:</strong> <a href="https://wiki.facepunch.com/gmod/">Garry's Mod Wiki</a>
<strong>Requisito previo:</strong> Este curso asume que ya conocés la sintaxis de Lua 5.1 (variables, funciones, tablas, loops, condicionales, metatables básicas). Acá nos enfocamos exclusivamente en <strong>cómo Lua funciona dentro de Garry's Mod</strong>.</p>
</blockquote>
<hr />
<h2 id="tabla-de-contenidos">Tabla de Contenidos</h2>
<ol>
<li><a href="#1-introducción-qué-es-glua">Introducción: ¿Qué es GLua?</a></li>
<li><a href="#2-el-entorno-de-desarrollo">El Entorno de Desarrollo</a></li>
<li><a href="#3-los-tres-reinos-realms">Los Tres Reinos (Realms)</a></li>
<li><a href="#4-estructura-de-archivos-y-addons">Estructura de Archivos y Addons</a></li>
<li><a href="#5-el-sistema-de-inclusión-de-archivos">El Sistema de Inclusión de Archivos</a></li>
<li><a href="#6-hooks-el-corazón-de-glua">Hooks: El Corazón de GLua</a></li>
<li><a href="#7-timers-control-del-tiempo">Timers: Control del Tiempo</a></li>
<li><a href="#8-comandos-de-consola-y-convars">Comandos de Consola y ConVars</a></li>
<li><a href="#9-entidades-el-sistema-central-del-motor">Entidades: El Sistema Central del Motor</a></li>
<li><a href="#10-el-jugador-player">El Jugador (Player)</a></li>
<li><a href="#11-networking-la-librería-net">Networking: La Librería Net</a></li>
<li><a href="#12-variables-de-red-nwvars-nw2vars-y-networkvar">Variables de Red (NWVars, NW2Vars y NetworkVar)</a></li>
<li><a href="#13-almacenamiento-de-datos-file-y-sql">Almacenamiento de Datos: file y sql</a></li>
<li><a href="#14-http-comunicación-con-el-exterior">HTTP: Comunicación con el Exterior</a></li>
<li><a href="#15-renderizado-2d-surface-y-draw">Renderizado 2D: surface y draw</a></li>
<li><a href="#16-fuentes-personalizadas">Fuentes Personalizadas</a></li>
<li><a href="#17-el-hud-interfaz-de-usuario-en-pantalla">El HUD: Interfaz de Usuario en Pantalla</a></li>
<li><a href="#18-vgui-y-derma-interfaces-interactivas">VGUI y Derma: Interfaces Interactivas</a></li>
<li><a href="#19-renderizado-3d-y-la-librería-cam">Renderizado 3D y la Librería cam</a></li>
<li><a href="#20-scripted-weapons-sweps">Scripted Weapons (SWEPs)</a></li>
<li><a href="#21-scripted-entities-sents">Scripted Entities (SENTs)</a></li>
<li><a href="#22-creación-de-gamemodes">Creación de Gamemodes</a></li>
<li><a href="#23-metatables-y-oop-en-glua">Metatables y OOP en GLua</a></li>
<li><a href="#24-optimización-y-buenas-prácticas">Optimización y Buenas Prácticas</a></li>
<li><a href="#25-seguridad-y-anti-exploit">Seguridad y Anti-Exploit</a></li>
<li><a href="#26-debugging-y-manejo-de-errores">Debugging y Manejo de Errores</a></li>
<li><a href="#27-publicación-en-el-workshop">Publicación en el Workshop</a></li>
<li><a href="#28-proyecto-final-addon-completo">Proyecto Final: Addon Completo</a></li>
</ol>
<hr />
<h2 id="1-introduccion-que-es-glua"><span class="num">01</span> Introducción: ¿Qué es GLua?</h2>
<p>GLua es la adaptación de <strong>Lua 5.1</strong> que Garry's Mod utiliza como lenguaje de scripting. Se ejecuta sobre <strong>LuaJIT</strong>, lo que le da un rendimiento muy superior al intérprete estándar de Lua. GLua extiende Lua estándar con cientos de funciones, librerías y sistemas diseñados para interactuar con el motor <strong>Source Engine</strong> sobre el que corre Garry's Mod.</p>
<h3 id="en-que-se-diferencia-glua-de-lua-estandar">¿En qué se diferencia GLua de Lua estándar?</h3>
<p>GLua conserva toda la sintaxis de Lua 5.1, pero agrega lo siguiente:</p>
<p><strong>Operadores adicionales:</strong> GLua incorpora los operadores <code>!=</code> (equivalente a <code>~=</code>), <code>!</code> (equivalente a <code>not</code>), <code>&amp;&amp;</code> (equivalente a <code>and</code>), <code>||</code> (equivalente a <code>or</code>), además de comentarios estilo C con <code>//</code> y <code>/* */</code>. Estos son "alias" — podés usar tanto los de Lua estándar como los de estilo C.</p>
<p><strong>Librerías nuevas:</strong> Cientos de funciones agrupadas en librerías como <code>hook</code>, <code>timer</code>, <code>net</code>, <code>surface</code>, <code>draw</code>, <code>vgui</code>, <code>render</code>, <code>cam</code>, <code>file</code>, <code>sql</code>, <code>http</code>, <code>game</code>, <code>player</code>, <code>ents</code>, <code>constraint</code>, <code>physenv</code>, y muchas más.</p>
<p><strong>Sistema de entidades:</strong> Todo en Garry's Mod es una entidad (jugadores, armas, props, NPCs). GLua provee un sistema completo de metatables para interactuar con ellas.</p>
<p><strong>Sistema de reinos (realms):</strong> El código se ejecuta en contextos separados (servidor, cliente, menú) que no comparten memoria entre sí.</p>
<p><strong>Funciones globales exclusivas:</strong> Como <code>IsValid()</code>, <code>LocalPlayer()</code>, <code>CurTime()</code>, <code>FrameTime()</code>, <code>ScrW()</code>, <code>ScrH()</code>, <code>PrintTable()</code>, <code>include()</code>, <code>AddCSLuaFile()</code>, <code>MsgC()</code>, entre otras.</p>
<h3 id="variable-global-_version">Variable global <code>_VERSION</code></h3>
<p>La variable global <code>_VERSION</code> en GLua contiene <code>"Lua 5.1"</code>, que es la versión del lenguaje que GMod utiliza internamente. Sin embargo, el motor real es <strong>LuaJIT</strong>, que es compatible con Lua 5.1 pero agrega extensiones de rendimiento como compilación JIT.</p>
<hr />
<h2 id="2-el-entorno-de-desarrollo"><span class="num">02</span> El Entorno de Desarrollo</h2>
<h3 id="editor-de-codigo">Editor de Código</h3>
<p>Necesitás un editor de texto con soporte para Lua/GLua. La opción más recomendada actualmente es <strong>Visual Studio Code</strong> con la extensión <strong>GLua Enhanced</strong> (<code>venner.vscode-glua-enhanced</code>) — te da autocompletado, resaltado de sintaxis específico de GLua, y acceso a la documentación de la wiki directamente desde el editor.</p>
<p>Alternativas válidas: Sublime Text con plugins de GLua, Neovim con configuración de LSP para Lua, o cualquier editor que soporte resaltado de Lua.</p>
<h3 id="donde-escribir-tu-codigo">Dónde escribir tu código</h3>
<p>Garry's Mod busca archivos Lua en estas ubicaciones principales:</p>
<div class="highlight"><pre><span></span><code>Steam/steamapps/common/GarrysMod/garrysmod/
├── lua/                    ← Archivos Lua sueltos (para pruebas rápidas)
├── addons/                 ← Tus addons (carpetas o archivos .gma)
└── gamemodes/              ← Gamemodes instalados
</code></pre></div>

<p>Para pruebas rápidas, podés colocar un archivo <code>.lua</code> en la carpeta <code>garrysmod/lua/</code> y ejecutarlo en la consola del juego con:</p>
<div class="highlight"><pre><span></span><code><span class="n">lua_openscript nombre_archivo.lua        -- Ejecuta en servidor</span>
<span class="n">lua_openscript_cl nombre_archivo.lua     -- Ejecuta en cliente</span>
</code></pre></div>

<p>Para desarrollo real, siempre vas a trabajar dentro de la carpeta <code>addons/</code>.</p>
<h3 id="la-consola-del-juego">La Consola del Juego</h3>
<p>La consola de Garry's Mod (abierta con la tecla <code>~</code>) es tu herramienta de debugging principal. Los comandos más útiles:</p>
<div class="highlight"><pre><span></span><code><span class="n">lua_run &lt;código&gt;              -- Ejecuta código Lua en el servidor</span>
<span class="n">lua_run_cl &lt;código&gt;           -- Ejecuta código Lua en el cliente</span>
<span class="n">lua_openscript &lt;archivo&gt;      -- Ejecuta un archivo .lua del servidor</span>
<span class="n">lua_openscript_cl &lt;archivo&gt;   -- Ejecuta un archivo .lua del cliente</span>
</code></pre></div>

<h3 id="auto-refresh-hotloading">Auto Refresh (HotLoading)</h3>
<p>Garry's Mod recargar automáticamente archivos Lua cuando los modificás mientras el juego está corriendo. Esto te permite editar código y ver los cambios sin reiniciar el servidor. Tené en cuenta que Auto Refresh tiene limitaciones — los hooks ya registrados no se eliminan automáticamente, y las variables globales mantienen sus valores anteriores.</p>
<hr />
<h2 id="3-los-tres-reinos-realms"><span class="num">03</span> Los Tres Reinos (Realms)</h2>
<p>Este es uno de los conceptos más importantes de GLua. Garry's Mod tiene <strong>tres estados de Lua completamente separados</strong> que no comparten memoria ni variables entre sí.</p>
<h3 id="31-realm-del-servidor-server">3.1. Realm del Servidor (Server)</h3>
<p>Es el estado que controla toda la lógica del juego: entidades, física, reglas, daño, spawn de jugadores. Es la "autoridad" — lo que el servidor dice, pasa.</p>
<div class="highlight"><pre><span></span><code><span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="c1">-- Este código solo se ejecuta en el servidor</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estoy en el servidor&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<p>La global <code>SERVER</code> es <code>true</code> en el realm del servidor y <code>nil</code> (falsy) en el cliente.</p>
<h3 id="32-realm-del-cliente-client">3.2. Realm del Cliente (Client)</h3>
<p>Maneja todo lo visual: renderizado, HUD, UI, efectos, sonidos, input del jugador. Cada jugador conectado tiene su propio estado de cliente. El cliente recibe información del servidor y la muestra, pero <strong>no debe tomar decisiones de juego por su cuenta</strong>.</p>
<div class="highlight"><pre><span></span><code><span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="c1">-- Este código solo se ejecuta en el cliente</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estoy en el cliente&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="33-realm-del-menu-menu">3.3. Realm del Menú (Menu)</h3>
<p>Estado aislado que solo existe para el menú principal del juego. No puede comunicarse con el servidor ni con el cliente directamente. Se detecta con <code>MENU_DLL</code>. Para desarrollo de addons, casi nunca lo vas a necesitar.</p>
<h3 id="34-shared-no-es-un-realm-real">3.4. "Shared" — No es un Realm Real</h3>
<p>Cuando la documentación dice que algo es <strong>"Shared"</strong>, significa que la función o hook <strong>existe tanto en Server como en Client</strong>, pero <strong>no</strong> que se ejecuta en ambos al mismo tiempo. Son dos estados separados ejecutando el mismo archivo.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Esto NO tiene sentido, la condición siempre es false:</span>
<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="c1">-- Nunca se ejecuta</span>
<span class="kr">end</span>

<span class="c1">-- Lo correcto es:</span>
<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="c1">-- Lógica del servidor</span>
<span class="kr">end</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="c1">-- Lógica del cliente</span>
<span class="kr">end</span>
</code></pre></div>

<hr />
<h2 id="4-estructura-de-archivos-y-addons"><span class="num">04</span> Estructura de Archivos y Addons</h2>
<h3 id="41-estructura-de-un-addon">4.1. Estructura de un Addon</h3>
<p>Todo addon vive dentro de <code>garrysmod/addons/nombre_de_tu_addon/</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">addons/mi_addon/</span>
<span class="n">├── lua/</span>
<span class="n">│   ├── autorun/                  ← Se ejecuta automáticamente al cargar</span>
<span class="n">│   │   ├── server/               ← Solo servidor (autorun)</span>
<span class="n">│   │   ├── client/               ← Solo cliente (autorun)</span>
<span class="n">│   │   └── mi_script_shared.lua  ← Shared (autorun)</span>
<span class="n">│   ├── weapons/                  ← Armas scripteadas (SWEPs)</span>
<span class="n">│   ├── entities/                 ← Entidades scripteadas (SENTs)</span>
<span class="n">│   ├── effects/                  ← Efectos visuales</span>
<span class="n">│   └── mi_addon/                 ← Tus módulos internos (convención)</span>
<span class="n">├── materials/                    ← Texturas e imágenes (.vmt, .vtf, .png)</span>
<span class="n">├── models/                       ← Modelos 3D</span>
<span class="n">├── sound/                        ← Archivos de sonido</span>
<span class="n">├── resource/</span>
<span class="n">│   └── fonts/                    ← Fuentes .ttf</span>
<span class="n">└── addon.json                    ← Metadata del addon (para Workshop)</span>
</code></pre></div>

<h3 id="42-directorios-especiales-de-lua">4.2. Directorios Especiales de Lua</h3>
<p><strong><code>lua/autorun/</code></strong> — Se ejecuta automáticamente cuando el servidor o el cliente arrancan. Es el punto de entrada más común.</p>
<p><strong><code>lua/autorun/server/</code></strong> — Solo servidor. No necesitás poner <code>if SERVER then</code>.</p>
<p><strong><code>lua/autorun/client/</code></strong> — Solo cliente. No necesitás poner <code>if CLIENT then</code>.</p>
<p><strong><code>lua/weapons/</code></strong> — Armas scripteadas. Cada arma es una carpeta o archivo con el nombre de la clase.</p>
<p><strong><code>lua/entities/</code></strong> — Entidades scripteadas. Misma lógica que weapons.</p>
<p><strong><code>lua/effects/</code></strong> — Efectos visuales del cliente.</p>
<h3 id="43-el-archivo-addonjson">4.3. El archivo addon.json</h3>
<p>Para publicar en el Workshop:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Mi Addon Increíble&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ServerContent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;fun&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;roleplay&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;ignore&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*.psd&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;*.xcf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;README.md&quot;</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>Los valores válidos para <code>type</code>: <code>ServerContent</code>, <code>gamemode</code>, <code>map</code>, <code>weapon</code>, <code>vehicle</code>, <code>npc</code>, <code>tool</code>, <code>effects</code>, <code>model</code>, <code>entity</code>.</p>
<p>Los valores válidos para <code>tags</code>: <code>fun</code>, <code>roleplay</code>, <code>scenic</code>, <code>movie</code>, <code>realism</code>, <code>cartoon</code>, <code>water</code>, <code>comic</code>, <code>build</code>.</p>
<hr />
<h2 id="5-el-sistema-de-inclusion-de-archivos"><span class="num">05</span> El Sistema de Inclusión de Archivos</h2>
<h3 id="51-include-y-addcsluafile">5.1. include() y AddCSLuaFile()</h3>
<p><strong><code>include(ruta)</code></strong> — Ejecuta un archivo Lua. Busca archivos relativos a <code>lua/</code>.</p>
<p><strong><code>AddCSLuaFile(ruta)</code></strong> — Le dice al servidor que <strong>envíe este archivo al cliente</strong> cuando se conecte. Solo tiene efecto en el servidor.</p>
<p>La regla de oro:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- En el servidor:</span>
<span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_hud.lua&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1">-- &quot;Mandá este archivo al cliente&quot;</span>
<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/sv_logica.lua&quot;</span><span class="p">)</span><span class="w">         </span><span class="c1">-- &quot;Ejecutá este archivo ahora&quot;</span>

<span class="c1">-- En el cliente:</span>
<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_hud.lua&quot;</span><span class="p">)</span><span class="w">            </span><span class="c1">-- &quot;Ejecutá este archivo ahora&quot;</span>
</code></pre></div>

<h3 id="52-patron-de-carga-tipico">5.2. Patrón de Carga Típico</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- lua/autorun/mi_addon_init.lua (Shared)</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_hud.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;mi_addon/sh_config.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_menu.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/sh_config.lua&quot;</span><span class="p">)</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/sv_logica.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/sv_comandos.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_hud.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;mi_addon/cl_menu.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="53-convencion-de-nombres-de-archivos">5.3. Convención de Nombres de Archivos</h3>
<div class="highlight"><pre><span></span><code><span class="n">sv_  → Solo servidor   (sv_logica.lua)</span>
<span class="n">cl_  → Solo cliente    (cl_hud.lua)</span>
<span class="n">sh_  → Shared          (sh_config.lua)</span>
</code></pre></div>

<h3 id="54-orden-de-carga">5.4. Orden de Carga</h3>
<p>GMod carga los archivos en este orden: archivos internos del motor → archivos del gamemode activo → archivos de <code>lua/autorun/</code> → archivos de addons (orden alfabético de la carpeta del addon). Dentro de cada directorio, los archivos se cargan en <strong>orden alfabético</strong>.</p>
<hr />
<h2 id="6-hooks-el-corazon-de-glua"><span class="num">06</span> Hooks: El Corazón de GLua</h2>
<p>El sistema de hooks es el mecanismo más importante de GLua. Permite que tu código reaccione a <strong>eventos</strong> del juego sin modificar el código fuente del motor.</p>
<h3 id="61-concepto">6.1. Concepto</h3>
<p>Pensá en un hook como una suscripción a un evento. El motor "dispara" eventos constantemente (un jugador se conecta, se renderiza un frame, alguien muere) y vos podés "engancharte" a esos eventos para ejecutar tu propio código.</p>
<h3 id="62-hookadd">6.2. hook.Add</h3>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="nv">nombre_del_evento</span><span class="p">,</span><span class="w"> </span><span class="nv">identificador_unico</span><span class="p">,</span><span class="w"> </span><span class="nv">funcion</span><span class="p">)</span>
</code></pre></div>

<ul>
<li><strong><code>nombre_del_evento</code></strong> — El nombre del hook (ej: <code>"PlayerSpawn"</code>, <code>"Think"</code>, <code>"HUDPaint"</code>).</li>
<li><strong><code>identificador_unico</code></strong> — String único que identifica tu hook. Si dos hooks tienen el mismo identificador para el mismo evento, el segundo reemplaza al primero.</li>
<li><strong><code>funcion</code></strong> — La función que se ejecuta. Recibe los argumentos que el hook provee.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">-- Mostrar un mensaje cada vez que un jugador spawnee</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_MensajeBienvenida&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;¡Bienvenido al servidor!&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="63-hookremove">6.3. hook.Remove</h3>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="s2">&quot;PlayerSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_MensajeBienvenida&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="64-hookrun-y-hookcall">6.4. hook.Run y hook.Call</h3>
<p><strong><code>hook.Run(nombre, ...args)</code></strong> — Dispara un evento. Todos los hooks registrados se ejecutan con los argumentos provistos. Ideal para eventos personalizados.</p>
<p><strong><code>hook.Call(nombre, gamemode_table, ...args)</code></strong> — Similar pero permite especificar una tabla de gamemode. <code>hook.Run</code> internamente llama a <code>hook.Call</code> con el gamemode actual.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Crear tu propio evento personalizado</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="s2">&quot;MiAddon_JugadorNivelSubio&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">jugador</span><span class="p">,</span><span class="w"> </span><span class="nv">nuevo_nivel</span><span class="p">)</span>

<span class="c1">-- Otro addon puede engancharse:</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;MiAddon_JugadorNivelSubio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;OtroAddon_Celebrar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">nivel</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;¡Felicitaciones! Llegaste al nivel &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">nivel</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="65-valores-de-retorno-en-hooks">6.5. Valores de Retorno en Hooks</h3>
<p>Algunos hooks permiten modificar el comportamiento del juego retornando valores:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Hacer que los jugadores del mismo equipo no se hagan daño</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerShouldTakeDamage&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_SinFuegoAmigo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">victima</span><span class="p">,</span><span class="w"> </span><span class="nv">atacante</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">atacante</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">atacante</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">victima</span><span class="p">:</span><span class="nf">Team</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">atacante</span><span class="p">:</span><span class="nf">Team</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">            </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">-- No recibe daño</span>
<span class="w">        </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="66-hooks-fundamentales">6.6. Hooks Fundamentales</h3>
<p><strong>Hooks del servidor:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">transition</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Conexión completa</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">          </span><span class="c1">-- Cada spawn</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDeath&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">victima</span><span class="p">,</span><span class="w"> </span><span class="nv">inflictor</span><span class="p">,</span><span class="w"> </span><span class="nv">atacante</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">   </span><span class="c1">-- Desconexión</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">texto</span><span class="p">,</span><span class="w"> </span><span class="nv">teamChat</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Chat</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;Think&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">                   </span><span class="c1">-- Cada tick (~66/seg)</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;Initialize&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">              </span><span class="c1">-- Inicialización del servidor</span>
</code></pre></div>

<p><strong>Hooks del cliente:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">                </span><span class="c1">-- Cada frame, para dibujar HUD</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDShouldDraw&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">nombre</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Ocultar HUD por defecto</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;Think&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">                   </span><span class="c1">-- Cada frame</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InitPostEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">)</span><span class="w">          </span><span class="c1">-- Cliente cargó completamente</span>
</code></pre></div>

<hr />
<h2 id="7-timers-control-del-tiempo"><span class="num">07</span> Timers: Control del Tiempo</h2>
<h3 id="71-timersimple">7.1. timer.Simple</h3>
<p>Ejecuta una función después de un delay, una sola vez:</p>
<div class="highlight"><pre><span></span><code><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;¡Pasaron 5 segundos!&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="72-timercreate">7.2. timer.Create</h3>
<p>Crea un timer con nombre que puede repetirse y ser controlado:</p>
<div class="highlight"><pre><span></span><code><span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nv">identificador</span><span class="p">,</span><span class="w"> </span><span class="nv">delay</span><span class="p">,</span><span class="w"> </span><span class="nv">repeticiones</span><span class="p">,</span><span class="w"> </span><span class="nv">funcion</span><span class="p">)</span>
<span class="c1">-- repeticiones: cantidad de veces. Usá 0 para infinito.</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- Dar $100 a todos cada 5 minutos, infinitamente</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Recibiste tu salario de $100&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="73-funciones-de-control">7.3. Funciones de Control</h3>
<div class="highlight"><pre><span></span><code><span class="nv">timer</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">       </span><span class="c1">-- Elimina</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">       </span><span class="c1">-- true/false</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">Pause</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">        </span><span class="c1">-- Pausa</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">UnPause</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">      </span><span class="c1">-- Reanuda</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">Toggle</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">       </span><span class="c1">-- Alterna pausa/reanuda</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">Adjust</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Cambia delay y repeticiones</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">TimeLeft</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Segundos restantes</span>
<span class="nv">timer</span><span class="p">.</span><span class="nf">RepsLeft</span><span class="p">(</span><span class="s2">&quot;MiAddon_Salario&quot;</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Repeticiones restantes</span>
</code></pre></div>

<p><strong><code>timer.Simple</code> vs <code>timer.Create</code></strong>: Usá <code>Simple</code> para delays rápidos que no necesitás cancelar. Usá <code>Create</code> cuando necesitás control (pausar, cancelar, repetir) o para evitar duplicados.</p>
<hr />
<h2 id="8-comandos-de-consola-y-convars"><span class="num">08</span> Comandos de Consola y ConVars</h2>
<h3 id="81-comandos-de-consola">8.1. Comandos de Consola</h3>
<div class="highlight"><pre><span></span><code><span class="nv">concommand</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;mi_teleport&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">cmd</span><span class="p">,</span><span class="w"> </span><span class="nv">args</span><span class="p">,</span><span class="w"> </span><span class="nv">argStr</span><span class="p">)</span>
<span class="w">    </span><span class="c1">-- ply: jugador que ejecutó | cmd: nombre del comando</span>
<span class="w">    </span><span class="c1">-- args: tabla de argumentos | argStr: string completo de argumentos</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetEyeTrace</span><span class="p">()</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">HitPos</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;¡Teletransportado!&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Teletransporta al jugador donde mira&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">FCVAR_NONE</span><span class="p">)</span>
</code></pre></div>

<h3 id="82-convars-variables-de-consola">8.2. ConVars (Variables de Consola)</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Crear ConVar del servidor</span>
<span class="nf">CreateConVar</span><span class="p">(</span><span class="s2">&quot;mi_addon_activado&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">FCVAR_ARCHIVE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">FCVAR_NOTIFY</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;Activa o desactiva mi addon&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>

<span class="c1">-- Flags comunes:</span>
<span class="c1">-- FCVAR_ARCHIVE     — Se guarda en el archivo de configuración</span>
<span class="c1">-- FCVAR_NOTIFY      — Notifica a todos cuando cambia</span>
<span class="c1">-- FCVAR_REPLICATED  — El valor se envía a todos los clientes</span>
<span class="c1">-- FCVAR_PROTECTED   — El valor no se muestra a los clientes</span>

<span class="c1">-- Leer una ConVar (cachear la referencia):</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">miConVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">GetConVar</span><span class="p">(</span><span class="s2">&quot;mi_addon_activado&quot;</span><span class="p">)</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Chequear&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">miConVar</span><span class="p">:</span><span class="nf">GetBool</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Mi addon está activo&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- Métodos: GetBool(), GetInt(), GetFloat(), GetString()</span>

<span class="c1">-- ConVar del cliente:</span>
<span class="nf">CreateClientConVar</span><span class="p">(</span><span class="s2">&quot;mi_addon_hud_color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;255 0 0&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Color del HUD&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="9-entidades-el-sistema-central-del-motor"><span class="num">09</span> Entidades: El Sistema Central del Motor</h2>
<p>En Garry's Mod, <strong>todo</strong> es una entidad: jugadores, armas, props, vehículos, NPCs, el mundo mismo.</p>
<h3 id="91-obtener-entidades">9.1. Obtener Entidades</h3>
<div class="highlight"><pre><span></span><code><span class="nf">Entity</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="w">                              </span><span class="c1">-- Por índice</span>
<span class="nv">ents</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span><span class="w">                           </span><span class="c1">-- Todas las entidades</span>
<span class="nv">ents</span><span class="p">.</span><span class="nf">FindByClass</span><span class="p">(</span><span class="s2">&quot;weapon_*&quot;</span><span class="p">)</span><span class="w">            </span><span class="c1">-- Por clase (soporta wildcards)</span>
<span class="nv">ents</span><span class="p">.</span><span class="nf">FindInSphere</span><span class="p">(</span><span class="nv">posicion</span><span class="p">,</span><span class="w"> </span><span class="nv">radio</span><span class="p">)</span><span class="w">      </span><span class="c1">-- En un radio</span>
<span class="nv">ents</span><span class="p">.</span><span class="nf">FindInBox</span><span class="p">(</span><span class="nv">mins</span><span class="p">,</span><span class="w"> </span><span class="nv">maxs</span><span class="p">)</span><span class="w">              </span><span class="c1">-- Dentro de una caja</span>
<span class="nv">game</span><span class="p">.</span><span class="nf">GetWorld</span><span class="p">()</span><span class="w">                         </span><span class="c1">-- La entidad del mundo (Entity(0))</span>
</code></pre></div>

<h3 id="92-metodos-fundamentales-de-entity">9.2. Métodos Fundamentales de Entity</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Verificación (SIEMPRE hacé esto antes de usar una entidad)</span>
<span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w">                  </span><span class="c1">-- ¿Existe y es válida?</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w">                </span><span class="c1">-- ¿Es un jugador?</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">IsNPC</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">IsWeapon</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">IsVehicle</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">IsWorld</span><span class="p">()</span>

<span class="c1">-- Posición y rotación</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">SetAngles</span><span class="p">(</span><span class="nf">Angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">GetForward</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetRight</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetUp</span><span class="p">()</span>

<span class="c1">-- Modelo y clase</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="s2">&quot;models/props_c17/oildrum001.mdl&quot;</span><span class="p">)</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">()</span><span class="w">                </span><span class="c1">-- &quot;prop_physics&quot;, &quot;player&quot;, etc.</span>

<span class="c1">-- Vida y color</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">SetColor</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">GetColor</span><span class="p">()</span>

<span class="c1">-- Eliminación</span>
<span class="nv">ent</span><span class="p">:</span><span class="nf">Remove</span><span class="p">()</span>
<span class="nf">SafeRemoveEntity</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w">                   </span><span class="c1">-- Versión segura (no tira error si es nil)</span>
<span class="nf">SafeRemoveEntityDelayed</span><span class="p">(</span><span class="nv">ent</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w">         </span><span class="c1">-- Elimina después de 5 segundos</span>
</code></pre></div>

<h3 id="93-crear-entidades-server-side">9.3. Crear Entidades (Server-side)</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">prop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ents</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;prop_physics&quot;</span><span class="p">)</span>
<span class="nv">prop</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="s2">&quot;models/props_c17/oildrum001.mdl&quot;</span><span class="p">)</span>
<span class="nv">prop</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<span class="nv">prop</span><span class="p">:</span><span class="nf">SetAngles</span><span class="p">(</span><span class="nf">Angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="nv">prop</span><span class="p">:</span><span class="nf">Spawn</span><span class="p">()</span>
<span class="nv">prop</span><span class="p">:</span><span class="nf">Activate</span><span class="p">()</span>
</code></pre></div>

<h3 id="94-traces-raycast">9.4. Traces (Raycast)</h3>
<p>Los traces son "rayos" que dispará para detectar qué entidades o superficies impactan:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Trace desde los ojos del jugador</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetEyeTrace</span><span class="p">()</span>
<span class="c1">-- tr.Hit (bool), tr.HitPos (Vector), tr.HitNormal (Vector)</span>
<span class="c1">-- tr.Entity (entidad impactada o NULL), tr.HitWorld (bool)</span>

<span class="c1">-- Trace manual con parámetros personalizados</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">resultado</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TraceLine</span><span class="p">({</span>
<span class="w">    </span><span class="nv">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">EyePos</span><span class="p">(),</span>
<span class="w">    </span><span class="nv">endpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">EyePos</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetAimVector</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span>
<span class="w">    </span><span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">,</span><span class="w">             </span><span class="c1">-- Ignorar esta entidad</span>
<span class="w">    </span><span class="nv">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">MASK_SOLID</span><span class="w">         </span><span class="c1">-- Qué superficies detectar</span>
<span class="p">})</span>
</code></pre></div>

<hr />
<h2 id="10-el-jugador-player"><span class="num">10</span> El Jugador (Player)</h2>
<p>El Player es una extensión de Entity con métodos adicionales. Todas las funciones de Entity funcionan en un Player.</p>
<h3 id="101-obtener-jugadores">10.1. Obtener Jugadores</h3>
<div class="highlight"><pre><span></span><code><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">()</span><span class="w">           </span><span class="c1">-- Todos los jugadores conectados</span>
<span class="nf">LocalPlayer</span><span class="p">()</span><span class="w">             </span><span class="c1">-- El jugador local (SOLO CLIENTE)</span>
<span class="nf">Player</span><span class="p">(</span><span class="nv">userID</span><span class="p">)</span><span class="w">            </span><span class="c1">-- Por UserID</span>
<span class="nv">player</span><span class="p">.</span><span class="nf">GetCount</span><span class="p">()</span><span class="w">         </span><span class="c1">-- Cantidad de jugadores</span>
</code></pre></div>

<h3 id="102-metodos-del-jugador">10.2. Métodos del Jugador</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Identificación</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Nick</span><span class="p">()</span><span class="w">                          </span><span class="c1">-- Nombre</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">()</span><span class="w">                       </span><span class="c1">-- STEAM_X:Y:Z</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()</span><span class="w">                     </span><span class="c1">-- SteamID en formato 64 bits</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">UserID</span><span class="p">()</span><span class="w">                        </span><span class="c1">-- ID de sesión</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">AccountID</span><span class="p">()</span><span class="w">                     </span><span class="c1">-- AccountID de Steam</span>

<span class="c1">-- Estado</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Alive</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsSuperAdmin</span><span class="p">()</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Team</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Ping</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsBot</span><span class="p">()</span>

<span class="c1">-- Posición y vista</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span><span class="w">              </span><span class="c1">-- Posición de los pies</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">EyePos</span><span class="p">()</span><span class="w">              </span><span class="c1">-- Posición de los ojos</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">EyeAngles</span><span class="p">()</span><span class="w">           </span><span class="c1">-- Ángulos de la vista</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">GetAimVector</span><span class="p">()</span><span class="w">        </span><span class="c1">-- Vector hacia donde mira</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">GetVelocity</span><span class="p">()</span><span class="w">         </span><span class="c1">-- Velocidad actual</span>

<span class="c1">-- Manipulación (SERVER)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Kill</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="s2">&quot;models/player/kleiner.mdl&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">StripWeapons</span><span class="p">()</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Freeze</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GodEnable</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GodDisable</span><span class="p">()</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Razón del kick&quot;</span><span class="p">)</span>

<span class="c1">-- Comunicación (SERVER)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Mensaje en el chat&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">PrintMessage</span><span class="p">(</span><span class="nv">HUD_PRINTTALK</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;En el chat&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">PrintMessage</span><span class="p">(</span><span class="nv">HUD_PRINTCENTER</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Centro de pantalla&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">PrintMessage</span><span class="p">(</span><span class="nv">HUD_PRINTCONSOLE</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;En la consola&quot;</span><span class="p">)</span>

<span class="c1">-- Armas</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">GetActiveWeapon</span><span class="p">()</span><span class="w">     </span><span class="c1">-- Arma activa</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">GetWeapons</span><span class="p">()</span><span class="w">          </span><span class="c1">-- Tabla de armas</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">HasWeapon</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SelectWeapon</span><span class="p">(</span><span class="s2">&quot;weapon_smg1&quot;</span><span class="p">)</span>

<span class="c1">-- Input (SHARED)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">KeyDown</span><span class="p">(</span><span class="nv">IN_FORWARD</span><span class="p">)</span><span class="w">   </span><span class="c1">-- W</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">KeyDown</span><span class="p">(</span><span class="nv">IN_JUMP</span><span class="p">)</span><span class="w">      </span><span class="c1">-- Space</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">KeyDown</span><span class="p">(</span><span class="nv">IN_ATTACK</span><span class="p">)</span><span class="w">    </span><span class="c1">-- Click izquierdo</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">KeyDown</span><span class="p">(</span><span class="nv">IN_ATTACK2</span><span class="p">)</span><span class="w">   </span><span class="c1">-- Click derecho</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">KeyDown</span><span class="p">(</span><span class="nv">IN_USE</span><span class="p">)</span><span class="w">       </span><span class="c1">-- E</span>
</code></pre></div>

<h3 id="103-ejemplo-comando-de-informacion">10.3. Ejemplo: Comando de Información</h3>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerSay&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_InfoEntidad&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">texto</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">texto</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;!info&quot;</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetEyeTrace</span><span class="p">()</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
<span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Mirando: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">GetClass</span><span class="p">())</span>
<span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Modelo: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">GetModel</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s2">&quot;sin modelo&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Vida: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">Health</span><span class="p">())</span>
<span class="w">        </span><span class="kr">else</span>
<span class="w">            </span><span class="nv">ply</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;No estás mirando ninguna entidad&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kr">end</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w">  </span><span class="c1">-- Oculta el mensaje del chat</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="11-networking-la-libreria-net"><span class="num">11</span> Networking: La Librería Net</h2>
<p>La librería <code>net</code> es el sistema principal para enviar datos entre servidor y cliente. Límite: <strong>65,533 bytes (~64KB) por mensaje</strong>, buffer interno de ~256KB.</p>
<h3 id="111-flujo-de-un-mensaje-net">11.1. Flujo de un Mensaje Net</h3>
<ol>
<li><strong>Registrar</strong> el nombre en el servidor con <code>util.AddNetworkString</code></li>
<li><strong>Iniciar</strong> con <code>net.Start</code></li>
<li><strong>Escribir</strong> datos con <code>net.Write*</code></li>
<li><strong>Enviar</strong> con <code>net.Send</code>, <code>net.Broadcast</code>, o <code>net.SendToServer</code></li>
<li><strong>Recibir</strong> con <code>net.Receive</code> y leer con <code>net.Read*</code></li>
</ol>
<h3 id="112-registrar-mensajes-server">11.2. Registrar Mensajes (Server)</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- SOLO EN EL SERVIDOR</span>
<span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">)</span>
<span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;MiAddon_ComprarItem&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Hay un límite de <strong>4096 mensajes net registrados</strong> en total en el servidor.</p>
<h3 id="113-funciones-de-escritura-y-lectura">11.3. Funciones de Escritura y Lectura</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Strings</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="s2">&quot;Hola&quot;</span><span class="p">)</span><span class="w">             </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>

<span class="c1">-- Números enteros (el segundo arg es la cantidad de bits)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteInt</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w">                 </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Con signo</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteUInt</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span><span class="w">                </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadUInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w">    </span><span class="c1">-- Sin signo</span>

<span class="c1">-- Decimales</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteFloat</span><span class="p">(</span><span class="mf">3.14</span><span class="p">)</span><span class="w">                 </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadFloat</span><span class="p">()</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteDouble</span><span class="p">(</span><span class="mf">3.14159265358979</span><span class="p">)</span><span class="w">    </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadDouble</span><span class="p">()</span>

<span class="c1">-- Booleanos</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteBool</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w">                  </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadBool</span><span class="p">()</span>

<span class="c1">-- Entidades</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteEntity</span><span class="p">(</span><span class="nv">jugador</span><span class="p">)</span><span class="w">             </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadEntity</span><span class="p">()</span>

<span class="c1">-- Vectores y Ángulos</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteVector</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w">     </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadVector</span><span class="p">()</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteAngle</span><span class="p">(</span><span class="nf">Angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w">      </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadAngle</span><span class="p">()</span>

<span class="c1">-- Tablas (convierte a JSON — cuidado con el tamaño)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteTable</span><span class="p">({</span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Test&quot;</span><span class="p">})</span><span class="w">    </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadTable</span><span class="p">()</span>

<span class="c1">-- Color</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">WriteColor</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w">     </span><span class="o">/</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadColor</span><span class="p">()</span>
</code></pre></div>

<h3 id="114-enviar-servidor-cliente">11.4. Enviar: Servidor → Cliente</h3>
<div class="highlight"><pre><span></span><code><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="s2">&quot;Título&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">jugador</span><span class="p">)</span><span class="w">           </span><span class="c1">-- A un jugador específico</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">({</span><span class="nv">ply1</span><span class="p">,</span><span class="w"> </span><span class="nv">ply2</span><span class="p">,</span><span class="w"> </span><span class="nv">ply3</span><span class="p">})</span><span class="w"> </span><span class="c1">-- A múltiples jugadores</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Broadcast</span><span class="p">()</span><span class="w">              </span><span class="c1">-- A todos</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">SendOmit</span><span class="p">(</span><span class="nv">jugador_excluido</span><span class="p">)</span><span class="w"> </span><span class="c1">-- A todos excepto uno</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_Efecto&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">SendPVS</span><span class="p">(</span><span class="nv">posicion_vector</span><span class="p">)</span><span class="w">   </span><span class="c1">-- A jugadores que pueden ver esa posición</span>
</code></pre></div>

<h3 id="115-enviar-cliente-servidor">11.5. Enviar: Cliente → Servidor</h3>
<div class="highlight"><pre><span></span><code><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;MiAddon_ComprarItem&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="s2">&quot;medkit&quot;</span><span class="p">)</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">SendToServer</span><span class="p">()</span>
</code></pre></div>

<h3 id="116-recibir-mensajes">11.6. Recibir Mensajes</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- En el CLIENTE:</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;MiAddon_AbrirMenu&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">longitud</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">titulo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Abriendo menú: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">titulo</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- En el SERVIDOR:</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;MiAddon_ComprarItem&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">longitud</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="c1">-- &#39;ply&#39; es el jugador que envió el mensaje</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">Nick</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; quiere comprar &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="117-ejemplo-completo-sistema-de-compra">11.7. Ejemplo Completo: Sistema de Compra</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- === SERVIDOR ===</span>
<span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Tienda_AbrirMenu&quot;</span><span class="p">)</span>
<span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Tienda_Comprar&quot;</span><span class="p">)</span>
<span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Tienda_Resultado&quot;</span><span class="p">)</span>

<span class="kd">local</span><span class="w"> </span><span class="nv">ITEMS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">medkit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Kit Médico&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">precio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">},</span>
<span class="w">    </span><span class="nv">armor</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Armadura&quot;</span><span class="p">,</span><span class="w">   </span><span class="nv">precio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">350</span><span class="p">},</span>
<span class="p">}</span>

<span class="nv">concommand</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;abrir_tienda&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Tienda_AbrirMenu&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteTable</span><span class="p">(</span><span class="nv">ITEMS</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Tienda_Comprar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ITEMS</span><span class="p">[</span><span class="nv">itemID</span><span class="p">]</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span><span class="w">  </span><span class="c1">-- Validar siempre del lado server</span>

<span class="w">    </span><span class="c1">-- Verificar dinero, etc.</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Tienda_Resultado&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteBool</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="s2">&quot;¡Compraste &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">nombre</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;!&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- === CLIENTE ===</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Tienda_AbrirMenu&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadTable</span><span class="p">()</span>
<span class="w">    </span><span class="c1">-- Crear panel VGUI con los items (ver sección de Derma)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Tienda_Resultado&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">exito</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadBool</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="nv">chat</span><span class="p">.</span><span class="nf">AddText</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;[Tienda] &quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="nv">msg</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- Función para comprar (llamada desde UI)</span>
<span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">ComprarItem</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Tienda_Comprar&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nv">itemID</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">SendToServer</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>

<hr />
<h2 id="12-variables-de-red-nwvars-nw2vars-y-networkvar"><span class="num">12</span> Variables de Red (NWVars, NW2Vars y NetworkVar)</h2>
<p>Tres sistemas para sincronizar variables entre servidor y cliente asociadas a entidades.</p>
<h3 id="121-nwvars-legacy">12.1. NWVars — Legacy</h3>
<p>El sistema original. Se actualizan continuamente y consumen ancho de banda constante.</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- SERVIDOR: Establecer</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetNWString</span><span class="p">(</span><span class="s2">&quot;trabajo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Policía&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetNWInt</span><span class="p">(</span><span class="s2">&quot;nivel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetNWBool</span><span class="p">(</span><span class="s2">&quot;estaVivo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>

<span class="c1">-- AMBOS: Leer (2do arg = valor por defecto)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">trabajo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetNWString</span><span class="p">(</span><span class="s2">&quot;trabajo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Desempleado&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="122-nw2vars-sistema-mejorado">12.2. NW2Vars — Sistema Mejorado</h3>
<p>Mucho más eficiente: usa su propia tabla de strings separada y solo envía cuando el valor cambia. <strong>Usá NW2 en lugar de NW siempre que sea posible.</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">ply</span><span class="p">:</span><span class="nf">SetNW2String</span><span class="p">(</span><span class="s2">&quot;trabajo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Policía&quot;</span><span class="p">)</span>
<span class="nv">ply</span><span class="p">:</span><span class="nf">SetNW2Int</span><span class="p">(</span><span class="s2">&quot;nivel&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">trabajo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">GetNW2String</span><span class="p">(</span><span class="s2">&quot;trabajo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Desempleado&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="123-networkvar-entitynetworkvar-setupdatatables">12.3. NetworkVar (Entity:NetworkVar / SetupDataTables)</h3>
<p>El sistema más eficiente para entidades scripteadas (SWEPs y SENTs). Las variables se definen en <code>SetupDataTables</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">SetupDataTables</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;String&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;OwnerName&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1">-- Crea Get/SetOwnerName</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Price&quot;</span><span class="p">)</span><span class="w">           </span><span class="c1">-- Crea Get/SetPrice</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Bool&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IsOpen&quot;</span><span class="p">)</span><span class="w">         </span><span class="c1">-- Crea Get/SetIsOpen</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Float&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Speed&quot;</span><span class="p">)</span><span class="w">         </span><span class="c1">-- Crea Get/SetSpeed</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Entity&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;LinkedEnt&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">-- Crea Get/SetLinkedEnt</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Vector&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TargetPos&quot;</span><span class="p">)</span><span class="w">    </span><span class="c1">-- Crea Get/SetTargetPos</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Angle&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;TargetAng&quot;</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Crea Get/SetTargetAng</span>
<span class="kr">end</span>

<span class="c1">-- Slots van de 0 a 31 por tipo. Se networkean automáticamente.</span>
</code></pre></div>

<h3 id="124-cuando-usar-cada-uno">12.4. ¿Cuándo usar cada uno?</h3>
<p><strong>NetworkVar</strong> → Para variables en tus SWEPs y SENTs. La opción más eficiente.</p>
<p><strong>NW2Vars</strong> → Para variables de jugadores o entidades del motor que no controlás.</p>
<p><strong>NWVars</strong> → Solo para compatibilidad con addons viejos.</p>
<p><strong>Net library</strong> → Para eventos puntuales, no para datos constantemente sincronizados.</p>
<hr />
<h2 id="13-almacenamiento-de-datos-file-y-sql"><span class="num">13</span> Almacenamiento de Datos: file y sql</h2>
<h3 id="131-la-libreria-file">13.1. La Librería file</h3>
<p>GMod permite leer y escribir archivos en <code>garrysmod/data/</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">file</span><span class="p">.</span><span class="nf">CreateDir</span><span class="p">(</span><span class="s2">&quot;mi_addon&quot;</span><span class="p">)</span>
<span class="nv">file</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s2">&quot;mi_addon/config.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hola mundo&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">contenido</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">file</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="s2">&quot;mi_addon/config.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span>
<span class="nv">file</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="s2">&quot;mi_addon/config.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">-- true/false</span>
<span class="nv">file</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="s2">&quot;mi_addon/config.txt&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">archivos</span><span class="p">,</span><span class="w"> </span><span class="nv">carpetas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">file</span><span class="p">.</span><span class="nf">Find</span><span class="p">(</span><span class="s2">&quot;mi_addon/*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span>
<span class="nv">file</span><span class="p">.</span><span class="nf">IsDir</span><span class="p">(</span><span class="s2">&quot;mi_addon&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Search paths: <code>"DATA"</code> (data/, lectura/escritura), <code>"LUA"</code> (lua/, solo lectura), <code>"GAME"</code> (raíz del juego, solo lectura), <code>"MOD"</code> (garrysmod/, solo lectura).</p>
<h3 id="132-guardar-y-cargar-con-json">13.2. Guardar y Cargar con JSON</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Guardar</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">datos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="nv">salario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nv">intervalo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span><span class="p">}}</span>
<span class="nv">file</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="s2">&quot;mi_addon/datos.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">(</span><span class="nv">datos</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">))</span>

<span class="c1">-- Cargar</span>
<span class="kd">local</span><span class="w"> </span><span class="kr">function</span><span class="w"> </span><span class="nf">CargarDatos</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">file</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="s2">&quot;mi_addon/datos.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">file</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="s2">&quot;mi_addon/datos.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DATA&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">JSONToTable</span><span class="p">(</span><span class="nv">json</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="p">{}</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="133-sqlite-sql-library">13.3. SQLite (sql library)</h3>
<p>Para datos más complejos o voluminosos:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- Crear tabla</span>
<span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">([[</span>
<span class="w">    </span><span class="nv">CREATE</span><span class="w"> </span><span class="nv">TABLE</span><span class="w"> </span><span class="nv">IF</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">EXISTS</span><span class="w"> </span><span class="nf">mi_addon_jugadores</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nv">steamid</span><span class="w"> </span><span class="nv">TEXT</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="w"> </span><span class="nv">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="nv">nombre</span><span class="w"> </span><span class="nv">TEXT</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">NULL</span><span class="p">,</span>
<span class="w">        </span><span class="nv">nivel</span><span class="w"> </span><span class="nv">INTEGER</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nv">dinero</span><span class="w"> </span><span class="nv">INTEGER</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">]])</span>

<span class="c1">-- Insertar (SIEMPRE usá sql.SQLStr para prevenir inyección SQL)</span>
<span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span>
<span class="w">    </span><span class="s2">&quot;REPLACE INTO mi_addon_jugadores (steamid, nombre) VALUES (%s, %s)&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nv">sql</span><span class="p">.</span><span class="nf">SQLStr</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()),</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">SQLStr</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">Nick</span><span class="p">())</span>
<span class="p">))</span>

<span class="c1">-- Leer</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM mi_addon_jugadores WHERE steamid = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">SQLStr</span><span class="p">(</span><span class="nv">sid</span><span class="p">))</span>
<span class="kr">if</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nv">nombre</span><span class="p">,</span><span class="w"> </span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nv">nivel</span><span class="p">)</span>
<span class="kr">end</span>

<span class="c1">-- sql.Query retorna nil si no hay resultados, false si hay error</span>
<span class="kr">if</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">LastError</span><span class="p">())</span><span class="w"> </span><span class="kr">end</span>
</code></pre></div>

<p><strong>Usá file (JSON)</strong> para configuraciones y datos pequeños. <strong>Usá sql</strong> para datos de muchos jugadores o que necesitan consultas.</p>
<hr />
<h2 id="14-http-comunicacion-con-el-exterior"><span class="num">14</span> HTTP: Comunicación con el Exterior</h2>
<h3 id="141-la-funcion-http">14.1. La Función HTTP()</h3>
<div class="highlight"><pre><span></span><code><span class="nf">HTTP</span><span class="p">({</span>
<span class="w">    </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://api.ejemplo.com/datos&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nv">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w">                                </span><span class="c1">-- GET, POST, PUT, DELETE</span>
<span class="w">    </span><span class="nv">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="nv">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">({</span><span class="nv">dato</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;valor&quot;</span><span class="p">}),</span>
<span class="w">    </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">codigo</span><span class="p">,</span><span class="w"> </span><span class="nv">cuerpo</span><span class="p">,</span><span class="w"> </span><span class="nv">headers</span><span class="p">)</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">datos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">JSONToTable</span><span class="p">(</span><span class="nv">cuerpo</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span><span class="p">,</span>
<span class="w">    </span><span class="nv">failed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">motivo</span><span class="p">)</span>
<span class="w">        </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error HTTP: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">motivo</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div>

<h3 id="142-wrappers-simplificados">14.2. Wrappers Simplificados</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- GET</span>
<span class="nv">http</span><span class="p">.</span><span class="nf">Fetch</span><span class="p">(</span><span class="s2">&quot;https://api.ejemplo.com/datos&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="kr">function</span><span class="p">(</span><span class="nv">cuerpo</span><span class="p">,</span><span class="w"> </span><span class="nv">tamanio</span><span class="p">,</span><span class="w"> </span><span class="nv">headers</span><span class="p">,</span><span class="w"> </span><span class="nv">codigo</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">,</span>
<span class="w">    </span><span class="kr">function</span><span class="p">(</span><span class="nb">error</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<span class="p">)</span>

<span class="c1">-- POST</span>
<span class="nv">http</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="s2">&quot;https://api.ejemplo.com/enviar&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">{</span><span class="nv">clave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;valor&quot;</span><span class="p">},</span>
<span class="w">    </span><span class="kr">function</span><span class="p">(</span><span class="nv">cuerpo</span><span class="p">,</span><span class="w"> </span><span class="nv">tamanio</span><span class="p">,</span><span class="w"> </span><span class="nv">headers</span><span class="p">,</span><span class="w"> </span><span class="nv">codigo</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span><span class="p">,</span>
<span class="w">    </span><span class="kr">function</span><span class="p">(</span><span class="nb">error</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="143-ejemplo-webhook-de-discord">14.3. Ejemplo: Webhook de Discord</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">WEBHOOK_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://discord.com/api/webhooks/TU_ID/TU_TOKEN&quot;</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Discord&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">timer</span><span class="p">.</span><span class="nf">Simple</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">        </span><span class="nf">HTTP</span><span class="p">({</span>
<span class="w">            </span><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">WEBHOOK_URL</span><span class="p">,</span>
<span class="w">            </span><span class="nv">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nv">headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="nv">body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">util</span><span class="p">.</span><span class="nf">TableToJSON</span><span class="p">({</span>
<span class="w">                </span><span class="nv">embeds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{{</span>
<span class="w">                    </span><span class="nv">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Jugador Conectado&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Nick</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; se conectó&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3066993</span><span class="p">,</span>
<span class="w">                    </span><span class="nv">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="p">{</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SteamID&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID</span><span class="p">(),</span><span class="w"> </span><span class="nv">inline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">},</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="nv">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;!%Y-%m-%dT%H:%M:%SZ&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">}}</span>
<span class="w">            </span><span class="p">}),</span>
<span class="w">            </span><span class="nb">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nv">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span><span class="p">,</span>
<span class="w">            </span><span class="nv">failed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">err</span><span class="p">)</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Discord] Error: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">err</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">    </span><span class="kr">end</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="15-renderizado-2d-surface-y-draw"><span class="num">15</span> Renderizado 2D: surface y draw</h2>
<p>Estas librerías dibujan elementos 2D en pantalla. Solo funcionan dentro de <strong>hooks de renderizado</strong> como <code>HUDPaint</code>.</p>
<h3 id="151-la-libreria-surface">15.1. La Librería surface</h3>
<p>Trabaja a nivel bajo — primero establecés color/material/fuente, luego dibujás:</p>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Dibujar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="c1">-- Rectángulo relleno</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">  </span><span class="c1">-- RGBA</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w">     </span><span class="c1">-- x, y, ancho, alto</span>

<span class="w">    </span><span class="c1">-- Rectángulo solo borde</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawOutlinedRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawOutlinedRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">  </span><span class="c1">-- grosor 2px</span>

<span class="w">    </span><span class="c1">-- Línea</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">350</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span><span class="w">  </span><span class="c1">-- x1, y1, x2, y2</span>

<span class="w">    </span><span class="c1">-- Texto</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetFont</span><span class="p">(</span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetTextColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetTextPos</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">65</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s2">&quot;Hola Mundo&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- Obtener tamaño de texto (útil para centrar)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetFont</span><span class="p">(</span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ancho</span><span class="p">,</span><span class="w"> </span><span class="nv">alto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">surface</span><span class="p">.</span><span class="nf">GetTextSize</span><span class="p">(</span><span class="s2">&quot;Hola Mundo&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- Dibujar una textura/material</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">miMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Material</span><span class="p">(</span><span class="s2">&quot;icon16/heart.png&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetMaterial</span><span class="p">(</span><span class="nv">miMat</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawTexturedRect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">250</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- Polígono (ej: círculo)</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">NoTexture</span><span class="p">()</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">circulo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">cx</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="p">,</span><span class="w"> </span><span class="nv">radio</span><span class="p">,</span><span class="w"> </span><span class="nv">segmentos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span>
<span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">segmentos</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">math.rad</span><span class="p">((</span><span class="nv">i</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">segmentos</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">360</span><span class="p">)</span>
<span class="w">        </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">circulo</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="nv">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">math.cos</span><span class="p">(</span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">radio</span><span class="p">,</span><span class="w"> </span><span class="nv">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">math.sin</span><span class="p">(</span><span class="nv">a</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nv">radio</span><span class="p">})</span>
<span class="w">    </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawPoly</span><span class="p">(</span><span class="nv">circulo</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="152-la-libreria-draw">15.2. La Librería draw</h3>
<p>Wrapper más conveniente de <code>surface</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Draw&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="c1">-- Texto simple (con alineación)</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;Hola&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">ScrW</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- Texto con borde (mejor legibilidad)</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleTextOutlined</span><span class="p">(</span><span class="s2">&quot;Con borde&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">ScrW</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span>
<span class="w">        </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w">  </span><span class="c1">-- grosor, color borde</span>

<span class="w">    </span><span class="c1">-- Rectángulo con esquinas redondeadas</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>

<span class="w">    </span><span class="c1">-- Redondeado selectivo por esquina</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBoxEx</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
<span class="w">        </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w">  </span><span class="c1">-- SupIzq, SupDer, InfIzq, InfDer</span>

<span class="w">    </span><span class="c1">-- Texto con word-wrap</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="s2">&quot;Texto largo que se ajusta al ancho...&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;DermaDefault&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="nv">TEXT_ALIGN_LEFT</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="16-fuentes-personalizadas"><span class="num">16</span> Fuentes Personalizadas</h2>
<h3 id="161-crear-una-fuente">16.1. Crear una Fuente</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Se ejecuta UNA VEZ al inicio (client-side)</span>
<span class="nv">surface</span><span class="p">.</span><span class="nf">CreateFont</span><span class="p">(</span><span class="s2">&quot;MiAddon_TituloGrande&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Arial&quot;</span><span class="p">,</span><span class="w">       </span><span class="c1">-- Nombre de la fuente del sistema</span>
<span class="w">    </span><span class="nv">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">48</span><span class="p">,</span><span class="w">            </span><span class="c1">-- Tamaño en píxeles</span>
<span class="w">    </span><span class="nv">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">700</span><span class="p">,</span><span class="w">         </span><span class="c1">-- 400=normal, 700=bold</span>
<span class="w">    </span><span class="nv">antialias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nv">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nv">outline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nv">extended</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">      </span><span class="c1">-- Soporta acentos, ñ, etc.</span>
<span class="p">})</span>
</code></pre></div>

<h3 id="162-fuentes-ttf-personalizadas">16.2. Fuentes .ttf Personalizadas</h3>
<ol>
<li>Colocá el <code>.ttf</code> en <code>resource/fonts/</code> de tu addon.</li>
<li>Registrala para descarga (server): <code>resource.AddFile("resource/fonts/mi_fuente.ttf")</code></li>
<li>Creá la fuente (client): usá el <strong>nombre interno</strong> del .ttf (no el nombre del archivo). Para encontrarlo, hacé doble click en el <code>.ttf</code> en Windows y leé el nombre en la preview.</li>
</ol>
<h3 id="163-fuentes-por-defecto-de-gmod">16.3. Fuentes por Defecto de GMod</h3>
<p>Podés usar sin crearlas: <code>"Default"</code>, <code>"DefaultBold"</code>, <code>"DermaDefault"</code>, <code>"DermaDefaultBold"</code>, <code>"DermaLarge"</code>, <code>"Trebuchet18"</code>, <code>"Trebuchet24"</code>, <code>"ChatFont"</code>, <code>"BudgetLabel"</code>, <code>"DebugFixed"</code>, entre otras.</p>
<hr />
<h2 id="17-el-hud-interfaz-de-usuario-en-pantalla"><span class="num">17</span> El HUD: Interfaz de Usuario en Pantalla</h2>
<h3 id="171-hud-personalizado">17.1. HUD Personalizado</h3>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_HUD&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Alive</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vida</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">armadura</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Armor</span><span class="p">()</span>

<span class="w">    </span><span class="c1">-- Fondo</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">))</span>

<span class="w">    </span><span class="c1">-- Barra de vida</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">vidaW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">math</span><span class="p">.</span><span class="nf">Clamp</span><span class="p">(</span><span class="nv">vida</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">270</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="mi">270</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="nv">vidaW</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="nv">vida</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; HP&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaDefaultBold&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="mi">170</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">72</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>

<span class="w">    </span><span class="c1">-- Barra de armadura</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">armorW</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">math</span><span class="p">.</span><span class="nf">Clamp</span><span class="p">(</span><span class="nv">armadura</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">270</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">270</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nv">armorW</span><span class="p">,</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">220</span><span class="p">))</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="nv">armadura</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; AP&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaDefaultBold&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="mi">170</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="172-ocultar-el-hud-por-defecto">17.2. Ocultar el HUD por Defecto</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">ocultar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;CHudHealth&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;CHudBattery&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;CHudAmmo&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;CHudSecondaryAmmo&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">[</span><span class="s2">&quot;CHudDamageIndicator&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="p">}</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDShouldDraw&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_OcultarHUD&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">nombre</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ocultar</span><span class="p">[</span><span class="nv">nombre</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="173-escalado-responsivo">17.3. Escalado Responsivo</h3>
<p>Para que tu HUD se vea bien en diferentes resoluciones:</p>
<div class="highlight"><pre><span></span><code><span class="c1">-- ScrW() y ScrH() dan las dimensiones de pantalla</span>
<span class="c1">-- ScreenScale(n) escala &#39;n&#39; proporcionalmente a resolución 1080p</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">margen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ScreenScale</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">ancho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ScreenScale</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="18-vgui-y-derma-interfaces-interactivas"><span class="num">18</span> VGUI y Derma: Interfaces Interactivas</h2>
<p>VGUI es el sistema de interfaz gráfica. Derma es la implementación de alto nivel con paneles listos para usar. Todo el código VGUI es <strong>client-side</strong>.</p>
<h3 id="181-panel-basico-dframe">18.1. Panel Básico: DFrame</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DFrame&quot;</span><span class="p">)</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="w"> </span><span class="mi">400</span><span class="p">)</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">Center</span><span class="p">()</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">SetTitle</span><span class="p">(</span><span class="s2">&quot;Mi Ventana&quot;</span><span class="p">)</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">SetDraggable</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">ShowCloseButton</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="nv">frame</span><span class="p">:</span><span class="nf">MakePopup</span><span class="p">()</span><span class="w">       </span><span class="c1">-- Captura input del mouse/teclado</span>
</code></pre></div>

<h3 id="182-paneles-derma-comunes">18.2. Paneles Derma Comunes</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- Botón</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;Hacer Algo&quot;</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">.</span><span class="py">DoClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;¡Click!&quot;</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- Label</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">lbl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DLabel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">lbl</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">)</span>
<span class="nv">lbl</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;Texto informativo&quot;</span><span class="p">)</span>
<span class="nv">lbl</span><span class="p">:</span><span class="nf">SizeToContents</span><span class="p">()</span>

<span class="c1">-- Input de texto</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">inp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DTextEntry&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">inp</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">120</span><span class="p">)</span>
<span class="nv">inp</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="nv">inp</span><span class="p">:</span><span class="nf">SetPlaceholderText</span><span class="p">(</span><span class="s2">&quot;Escribí algo...&quot;</span><span class="p">)</span>
<span class="nv">inp</span><span class="p">.</span><span class="py">OnEnter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">)</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetValue</span><span class="p">())</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- CheckBox</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">chk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DCheckBoxLabel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">chk</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">160</span><span class="p">)</span>
<span class="nv">chk</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;Activar opción&quot;</span><span class="p">)</span>
<span class="nv">chk</span><span class="p">:</span><span class="nf">SetValue</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="nv">chk</span><span class="p">.</span><span class="py">OnChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="nb">tostring</span><span class="p">(</span><span class="nv">val</span><span class="p">))</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- ComboBox (Dropdown)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">cmb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DComboBox&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">:</span><span class="nf">SetValue</span><span class="p">(</span><span class="s2">&quot;Seleccioná...&quot;</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">:</span><span class="nf">AddChoice</span><span class="p">(</span><span class="s2">&quot;Opción 1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;val1&quot;</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">:</span><span class="nf">AddChoice</span><span class="p">(</span><span class="s2">&quot;Opción 2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;val2&quot;</span><span class="p">)</span>
<span class="nv">cmb</span><span class="p">.</span><span class="py">OnSelect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">idx</span><span class="p">,</span><span class="w"> </span><span class="nv">val</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="nv">val</span><span class="p">,</span><span class="w"> </span><span class="nv">data</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- Slider numérico</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">sld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DNumSlider&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">240</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;Volumen&quot;</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetMin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetMax</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetDecimals</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">:</span><span class="nf">SetValue</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="nv">sld</span><span class="p">.</span><span class="py">OnValueChanged</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="nv">val</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- Scroll Panel</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">scroll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DScrollPanel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">scroll</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">)</span>
<span class="nv">scroll</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">210</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">)</span>

<span class="kr">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="kr">do</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">scroll</span><span class="p">:</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;DButton&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">item</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;Item &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">i</span><span class="p">)</span>
<span class="w">    </span><span class="nv">item</span><span class="p">:</span><span class="nf">SetTall</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="w">    </span><span class="nv">item</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">TOP</span><span class="p">)</span>
<span class="w">    </span><span class="nv">item</span><span class="p">:</span><span class="nf">DockMargin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="183-docking-acoplamiento">18.3. Docking (Acoplamiento)</h3>
<p>Sistema fundamental para layouts responsivos:</p>
<div class="highlight"><pre><span></span><code><span class="nv">panel</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">TOP</span><span class="p">)</span><span class="w">      </span><span class="c1">-- Ocupa todo el ancho, se pega arriba</span>
<span class="nv">panel</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">BOTTOM</span><span class="p">)</span><span class="w">   </span><span class="c1">-- Ocupa todo el ancho, se pega abajo</span>
<span class="nv">panel</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">LEFT</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Ocupa todo el alto, se pega a la izquierda</span>
<span class="nv">panel</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">RIGHT</span><span class="p">)</span><span class="w">    </span><span class="c1">-- Ocupa todo el alto, se pega a la derecha</span>
<span class="nv">panel</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">FILL</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Llena el espacio restante</span>

<span class="nv">panel</span><span class="p">:</span><span class="nf">DockMargin</span><span class="p">(</span><span class="nv">izq</span><span class="p">,</span><span class="w"> </span><span class="nv">arriba</span><span class="p">,</span><span class="w"> </span><span class="nv">der</span><span class="p">,</span><span class="w"> </span><span class="nv">abajo</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Margen externo</span>
<span class="nv">panel</span><span class="p">:</span><span class="nf">DockPadding</span><span class="p">(</span><span class="nv">izq</span><span class="p">,</span><span class="w"> </span><span class="nv">arriba</span><span class="p">,</span><span class="w"> </span><span class="nv">der</span><span class="p">,</span><span class="w"> </span><span class="nv">abajo</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Padding interno</span>
</code></pre></div>

<h3 id="184-paint-personalizar-la-apariencia">18.4. Paint: Personalizar la Apariencia</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DButton&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">:</span><span class="nf">SetSize</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<span class="nv">btn</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Quitamos texto default</span>

<span class="nv">btn</span><span class="p">.</span><span class="py">Paint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="nv">w</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">IsHovered</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">IsDown</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">160</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">w</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="p">,</span><span class="w"> </span><span class="nv">color</span><span class="p">)</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;Mi Botón&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaDefaultBold&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nv">w</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="185-crear-paneles-personalizados-vgui-register">18.5. Crear Paneles Personalizados (VGUI Register)</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">PANEL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">PANEL</span><span class="p">:</span><span class="nf">Init</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;DLabel&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">label</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">FILL</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">label</span><span class="p">:</span><span class="nf">SetContentAlignment</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w">  </span><span class="c1">-- Centrado</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">PANEL</span><span class="p">:</span><span class="nf">SetTexto</span><span class="p">(</span><span class="nv">texto</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">label</span><span class="p">:</span><span class="nf">SetText</span><span class="p">(</span><span class="nv">texto</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">PANEL</span><span class="p">:</span><span class="nf">Paint</span><span class="p">(</span><span class="nv">w</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="p">)</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">w</span><span class="p">,</span><span class="w"> </span><span class="nv">h</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">40</span><span class="p">))</span>
<span class="kr">end</span>

<span class="nv">vgui</span><span class="p">.</span><span class="nf">Register</span><span class="p">(</span><span class="s2">&quot;MiPanelCustom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">PANEL</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DPanel&quot;</span><span class="p">)</span>

<span class="c1">-- Uso:</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">vgui</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;MiPanelCustom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">frame</span><span class="p">)</span>
<span class="nv">p</span><span class="p">:</span><span class="nf">Dock</span><span class="p">(</span><span class="nv">TOP</span><span class="p">)</span>
<span class="nv">p</span><span class="p">:</span><span class="nf">SetTall</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="nv">p</span><span class="p">:</span><span class="nf">SetTexto</span><span class="p">(</span><span class="s2">&quot;¡Panel personalizado!&quot;</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="19-renderizado-3d-y-la-libreria-cam"><span class="num">19</span> Renderizado 3D y la Librería cam</h2>
<p>La librería <code>cam</code> permite dibujar 2D en el espacio 3D del mundo. Muy útil para interfaces flotantes sobre entidades.</p>
<h3 id="191-camstart3d2d">19.1. cam.Start3D2D</h3>
<div class="highlight"><pre><span></span><code><span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PostDrawOpaqueRenderables&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Texto3D&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>

<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">Start3D2D</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span><span class="w">  </span><span class="c1">-- 0.1 = escala</span>
<span class="w">        </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">150</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
<span class="w">        </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;¡Hola Mundo 3D!&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span>
<span class="w">            </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">End3D2D</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="192-3d2d-en-una-entidad-sent">19.2. 3D2D en una Entidad (SENT)</h3>
<div class="highlight"><pre><span></span><code><span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">Draw</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">DrawModel</span><span class="p">()</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetUp</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">50</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetAngles</span><span class="p">()</span>
<span class="w">    </span><span class="nv">ang</span><span class="p">:</span><span class="nf">RotateAroundAxis</span><span class="p">(</span><span class="nv">ang</span><span class="p">:</span><span class="nf">Up</span><span class="p">(),</span><span class="w"> </span><span class="mi">90</span><span class="p">)</span>

<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">Start3D2D</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">)</span>
<span class="w">        </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;Precio: $500&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
<span class="w">            </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">End3D2D</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>

<hr />
<h2 id="20-scripted-weapons-sweps"><span class="num">20</span> Scripted Weapons (SWEPs)</h2>
<h3 id="201-estructura-de-archivos">20.1. Estructura de Archivos</h3>
<div class="highlight"><pre><span></span><code><span class="n">lua/weapons/arma_ejemplo/</span>
<span class="n">├── shared.lua    ← Propiedades y funciones shared</span>
<span class="n">├── cl_init.lua   ← Visual, HUD del arma</span>
<span class="n">└── init.lua      ← Lógica del servidor</span>
</code></pre></div>

<p>O un solo archivo: <code>lua/weapons/arma_ejemplo.lua</code></p>
<h3 id="202-swep-basica-completa">20.2. SWEP Básica Completa</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- lua/weapons/arma_curativa.lua (shared)</span>

<span class="nv">SWEP</span><span class="p">.</span><span class="py">PrintName</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Arma Curativa&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Author</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Tu Nombre&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Instructions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Click izq: curar otro. Click der: curarte.&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Category</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Mi Addon&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Spawnable</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">AdminOnly</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="nv">SWEP</span><span class="p">.</span><span class="py">ViewModel</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/weapons/c_medkit.mdl&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">WorldModel</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;models/weapons/w_medkit.mdl&quot;</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">UseHands</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="nv">SWEP</span><span class="p">.</span><span class="py">Primary</span><span class="p">.</span><span class="py">ClipSize</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w">    </span><span class="c1">-- -1 = sin cargador</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Primary</span><span class="p">.</span><span class="py">DefaultClip</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Primary</span><span class="p">.</span><span class="py">Automatic</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Primary</span><span class="p">.</span><span class="py">Ammo</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>

<span class="nv">SWEP</span><span class="p">.</span><span class="py">Secondary</span><span class="p">.</span><span class="py">ClipSize</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Secondary</span><span class="p">.</span><span class="py">DefaultClip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Secondary</span><span class="p">.</span><span class="py">Automatic</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="nv">SWEP</span><span class="p">.</span><span class="py">Secondary</span><span class="p">.</span><span class="py">Ammo</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;none&quot;</span>

<span class="nv">SWEP</span><span class="p">.</span><span class="py">HoldType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;slam&quot;</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">SWEP</span><span class="p">:</span><span class="nf">Initialize</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetHoldType</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="py">HoldType</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">SWEP</span><span class="p">:</span><span class="nf">PrimaryAttack</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetNextPrimaryFire</span><span class="p">(</span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetOwner</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">tr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">GetEyeTrace</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="kr">then</span>
<span class="w">            </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()))</span>
<span class="w">            </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Curaste a &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">tr</span><span class="p">.</span><span class="py">Entity</span><span class="p">:</span><span class="nf">Nick</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; (+25 HP)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">SWEP</span><span class="p">:</span><span class="nf">SecondaryAttack</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetNextSecondaryFire</span><span class="p">(</span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetOwner</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">owner</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">owner</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="nv">owner</span><span class="p">:</span><span class="nf">GetMaxHealth</span><span class="p">()))</span>
<span class="w">    </span><span class="nv">owner</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;Te curaste (+10 HP)&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="c1">-- Mira personalizada (CLIENT)</span>
<span class="kr">function</span><span class="w"> </span><span class="nc">SWEP</span><span class="p">:</span><span class="nf">DrawHUD</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">cx</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">ScrW</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrH</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetDrawColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="nv">cx</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="p">,</span><span class="w"> </span><span class="nv">cx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="p">)</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">DrawLine</span><span class="p">(</span><span class="nv">cx</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="nv">cx</span><span class="p">,</span><span class="w"> </span><span class="nv">cy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="203-hooks-de-swep-importantes">20.3. Hooks de SWEP Importantes</h3>
<div class="highlight"><pre><span></span><code><span class="nv">SWEP</span><span class="p">:</span><span class="nf">Initialize</span><span class="p">()</span><span class="w">                </span><span class="c1">-- Cuando se crea</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">Deploy</span><span class="p">()</span><span class="w">                    </span><span class="c1">-- Cuando la saca</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">Holster</span><span class="p">(</span><span class="nv">armaEntrante</span><span class="p">)</span><span class="w">       </span><span class="c1">-- Cuando la guarda</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">PrimaryAttack</span><span class="p">()</span><span class="w">             </span><span class="c1">-- Click izquierdo</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">SecondaryAttack</span><span class="p">()</span><span class="w">           </span><span class="c1">-- Click derecho</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">Reload</span><span class="p">()</span><span class="w">                    </span><span class="c1">-- Tecla R</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">Think</span><span class="p">()</span><span class="w">                     </span><span class="c1">-- Cada tick</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">DrawHUD</span><span class="p">()</span><span class="w">                   </span><span class="c1">-- Dibujar HUD del arma (CLIENT)</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">DrawWorldModel</span><span class="p">()</span><span class="w">            </span><span class="c1">-- Modelo en el mundo (CLIENT)</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">Equip</span><span class="p">(</span><span class="nv">owner</span><span class="p">)</span><span class="w">                </span><span class="c1">-- Cuando la recogen</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">OnDrop</span><span class="p">()</span><span class="w">                    </span><span class="c1">-- Cuando la tiran</span>
<span class="nv">SWEP</span><span class="p">:</span><span class="nf">OnRemove</span><span class="p">()</span><span class="w">                  </span><span class="c1">-- Cuando se elimina</span>
</code></pre></div>

<hr />
<h2 id="21-scripted-entities-sents"><span class="num">21</span> Scripted Entities (SENTs)</h2>
<h3 id="211-estructura">21.1. Estructura</h3>
<div class="highlight"><pre><span></span><code><span class="n">lua/entities/ent_ejemplo/</span>
<span class="n">├── shared.lua</span>
<span class="n">├── cl_init.lua</span>
<span class="n">└── init.lua</span>
</code></pre></div>

<h3 id="212-sent-completa-caja-de-suministros">21.2. SENT Completa: Caja de Suministros</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- === shared.lua ===</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">Type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;anim&quot;</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">Base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;base_gmodentity&quot;</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">PrintName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Caja de Suministros&quot;</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">Author</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Tu Nombre&quot;</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">Category</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Mi Addon&quot;</span>
<span class="nv">ENT</span><span class="p">.</span><span class="py">Spawnable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">SetupDataTables</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Int&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Uses&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">NetworkVar</span><span class="p">(</span><span class="s2">&quot;Bool&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;IsEmpty&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === init.lua (SERVER) ===</span>
<span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>
<span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;cl_init.lua&quot;</span><span class="p">)</span>
<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">Initialize</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="s2">&quot;models/props_junk/wood_crate001a.mdl&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">PhysicsInit</span><span class="p">(</span><span class="nv">SOLID_VPHYSICS</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetMoveType</span><span class="p">(</span><span class="nv">MOVETYPE_VPHYSICS</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetSolid</span><span class="p">(</span><span class="nv">SOLID_VPHYSICS</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetUseType</span><span class="p">(</span><span class="nv">SIMPLE_USE</span><span class="p">)</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">phys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPhysicsObject</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">phys</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">phys</span><span class="p">:</span><span class="nf">Wake</span><span class="p">()</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetUses</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetIsEmpty</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">Use</span><span class="p">(</span><span class="nv">activator</span><span class="p">,</span><span class="w"> </span><span class="nv">caller</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">activator</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">activator</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetIsEmpty</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;La caja está vacía&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kr">return</span>
<span class="w">    </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">activator</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">activator</span><span class="p">:</span><span class="nf">Health</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<span class="w">    </span><span class="nv">activator</span><span class="p">:</span><span class="nf">SetArmor</span><span class="p">(</span><span class="nb">math.min</span><span class="p">(</span><span class="nv">activator</span><span class="p">:</span><span class="nf">Armor</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<span class="w">    </span><span class="nv">activator</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;+25 HP, +15 Armor&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetUses</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetUses</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetUses</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="nv">self</span><span class="p">:</span><span class="nf">SetIsEmpty</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
<span class="w">        </span><span class="nf">SafeRemoveEntityDelayed</span><span class="p">(</span><span class="nv">self</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">OnTakeDamage</span><span class="p">(</span><span class="nv">dmg</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">TakePhysicsDamage</span><span class="p">(</span><span class="nv">dmg</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === cl_init.lua (CLIENT) ===</span>
<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">ENT</span><span class="p">:</span><span class="nf">Draw</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">DrawModel</span><span class="p">()</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">():</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">dist</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">300</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetUp</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">40</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">LocalPlayer</span><span class="p">():</span><span class="nf">EyeAngles</span><span class="p">()</span>
<span class="w">    </span><span class="nv">ang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Angle</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">.</span><span class="py">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">)</span>

<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">Start3D2D</span><span class="p">(</span><span class="nv">pos</span><span class="p">,</span><span class="w"> </span><span class="nv">ang</span><span class="p">,</span><span class="w"> </span><span class="mf">0.15</span><span class="p">)</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">texto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetIsEmpty</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="s2">&quot;VACÍA&quot;</span>
<span class="w">            </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;Suministros (&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetUses</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; usos)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetIsEmpty</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="w">            </span><span class="ow">or</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>

<span class="w">        </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="nv">texto</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">color</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="w">    </span><span class="nv">cam</span><span class="p">.</span><span class="nf">End3D2D</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>

<hr />
<h2 id="22-creacion-de-gamemodes"><span class="num">22</span> Creación de Gamemodes</h2>
<p>Un gamemode define las reglas del juego.</p>
<h3 id="221-estructura">22.1. Estructura</h3>
<div class="highlight"><pre><span></span><code><span class="n">gamemodes/mi_gamemode/</span>
<span class="n">├── mi_gamemode.txt</span>
<span class="n">└── gamemode/</span>
<span class="n">    ├── init.lua         ← Servidor</span>
<span class="n">    ├── cl_init.lua      ← Cliente</span>
<span class="n">    └── shared.lua       ← Compartido</span>
</code></pre></div>

<h3 id="222-archivos-basicos">22.2. Archivos Básicos</h3>
<p><strong><code>mi_gamemode.txt</code>:</strong></p>
<div class="highlight"><pre><span></span><code>&quot;mi_gamemode&quot;
{
    &quot;base&quot;       &quot;base&quot;
    &quot;title&quot;      &quot;Mi Gamemode&quot;
    &quot;maps&quot;       &quot;^gm_&quot;
    &quot;menusystem&quot; &quot;1&quot;
}
</code></pre></div>

<p><strong><code>shared.lua</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nv">GM</span><span class="p">.</span><span class="py">Name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Mi Gamemode&quot;</span>
<span class="nv">GM</span><span class="p">.</span><span class="py">Author</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Tu Nombre&quot;</span>
<span class="c1">-- DeriveGamemode(&quot;sandbox&quot;)  -- Para heredar de otro gamemode</span>
</code></pre></div>

<p><strong><code>init.lua</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>
<span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;cl_init.lua&quot;</span><span class="p">)</span>
<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">PlayerSpawn</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">BaseClass</span><span class="p">:</span><span class="nf">PlayerSpawn</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetModel</span><span class="p">(</span><span class="s2">&quot;models/player/kleiner.mdl&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SetHealth</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_pistol&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Give</span><span class="p">(</span><span class="s2">&quot;weapon_crowbar&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">PlayerDeath</span><span class="p">(</span><span class="nv">victima</span><span class="p">,</span><span class="w"> </span><span class="nv">inflictor</span><span class="p">,</span><span class="w"> </span><span class="nv">atacante</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">atacante</span><span class="p">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">atacante</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="nv">atacante</span><span class="p">:</span><span class="nf">AddFrags</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">DoPlayerDeath</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">atacante</span><span class="p">,</span><span class="w"> </span><span class="nv">dmg</span><span class="p">)</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">.</span><span class="py">NextSpawnTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">CreateRagdoll</span><span class="p">()</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">PlayerDeathThink</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">.</span><span class="py">NextSpawnTime</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">ply</span><span class="p">.</span><span class="py">NextSpawnTime</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">Spawn</span><span class="p">()</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
<span class="kr">end</span>
</code></pre></div>

<p><strong><code>cl_init.lua</code>:</strong></p>
<div class="highlight"><pre><span></span><code><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;shared.lua&quot;</span><span class="p">)</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">HUDPaint</span><span class="p">()</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;Mi Gamemode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">ScrW</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">GM</span><span class="p">:</span><span class="nf">HUDShouldDraw</span><span class="p">(</span><span class="nv">nombre</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span><span class="c1">-- Ocultar HUD default</span>
<span class="kr">end</span>
</code></pre></div>

<h3 id="223-hooks-de-gamemode">22.3. Hooks de Gamemode</h3>
<p>En un gamemode, los hooks se definen como métodos de <code>GM</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">GM</span><span class="p">:</span><span class="nf">Initialize</span><span class="p">()</span><span class="w">                   </span><span class="c1">-- Inicialización</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerSpawn</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w">               </span><span class="c1">-- Spawn</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerDeath</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">inf</span><span class="p">,</span><span class="w"> </span><span class="nv">att</span><span class="p">)</span><span class="w">     </span><span class="c1">-- Muerte</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerDisconnected</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w">        </span><span class="c1">-- Desconexión</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerSay</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">text</span><span class="p">,</span><span class="w"> </span><span class="nv">teamChat</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Chat</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">Think</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">GM</span><span class="p">:</span><span class="nf">Tick</span><span class="p">()</span><span class="w">            </span><span class="c1">-- Cada tick</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerLoadout</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w">             </span><span class="c1">-- Dar armas</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">PlayerSetModel</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w">            </span><span class="c1">-- Asignar modelo</span>
<span class="nv">GM</span><span class="p">:</span><span class="nf">ShowTeam</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nv">GM</span><span class="p">:</span><span class="nf">ShowHelp</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="c1">-- F2 / F1</span>
</code></pre></div>

<hr />
<h2 id="23-metatables-y-oop-en-glua"><span class="num">23</span> Metatables y OOP en GLua</h2>
<h3 id="231-metatables-de-entidades">23.1. Metatables de Entidades</h3>
<p>Cada tipo de entidad tiene su metatable accesible con <code>FindMetaTable()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">PLAYER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">FindMetaTable</span><span class="p">(</span><span class="s2">&quot;Player&quot;</span><span class="p">)</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">ENTITY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">FindMetaTable</span><span class="p">(</span><span class="s2">&quot;Entity&quot;</span><span class="p">)</span>

<span class="c1">-- Agregar método a TODOS los jugadores:</span>
<span class="kr">function</span><span class="w"> </span><span class="nc">PLAYER</span><span class="p">:</span><span class="nf">SaludarEnChat</span><span class="p">()</span>
<span class="w">    </span><span class="nv">self</span><span class="p">:</span><span class="nf">ChatPrint</span><span class="p">(</span><span class="s2">&quot;¡Hola, &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">Nick</span><span class="p">()</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot;!&quot;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="c1">-- Ahora: ply:SaludarEnChat()</span>

<span class="c1">-- Agregar método a TODAS las entidades:</span>
<span class="kr">function</span><span class="w"> </span><span class="nc">ENTITY</span><span class="p">:</span><span class="nf">DistanciaA</span><span class="p">(</span><span class="nv">otra</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">():</span><span class="nf">Distance</span><span class="p">(</span><span class="nv">otra</span><span class="p">:</span><span class="nf">GetPos</span><span class="p">())</span>
<span class="kr">end</span>
<span class="c1">-- Ahora: ent1:DistanciaA(ent2)</span>
</code></pre></div>

<h3 id="232-crear-objetos-con-oop">23.2. Crear Objetos con OOP</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">Inventario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="nv">Inventario</span><span class="p">.</span><span class="py">__index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Inventario</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Inventario</span><span class="p">.</span><span class="nf">Nuevo</span><span class="p">(</span><span class="nv">duenio</span><span class="p">,</span><span class="w"> </span><span class="nv">tamano</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">setmetatable</span><span class="p">({},</span><span class="w"> </span><span class="nv">Inventario</span><span class="p">)</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">duenio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">duenio</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">tamano</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tamano</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">20</span>
<span class="w">    </span><span class="nv">self</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">self</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Inventario</span><span class="p">:</span><span class="nf">AgregarItem</span><span class="p">(</span><span class="nv">item</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">self</span><span class="p">.</span><span class="py">items</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">self</span><span class="p">.</span><span class="py">tamano</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Lleno&quot;</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="nb">table.insert</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="nv">item</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="kc">true</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Inventario</span><span class="p">:</span><span class="nf">RemoverItem</span><span class="p">(</span><span class="nv">indice</span><span class="p">)</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nb">table.remove</span><span class="p">(</span><span class="nv">self</span><span class="p">.</span><span class="py">items</span><span class="p">,</span><span class="w"> </span><span class="nv">indice</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Inventario</span><span class="p">:</span><span class="nf">GetCantidad</span><span class="p">()</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="o">#</span><span class="nv">self</span><span class="p">.</span><span class="py">items</span>
<span class="kr">end</span>

<span class="c1">-- Uso:</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">inv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Inventario</span><span class="p">.</span><span class="nf">Nuevo</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
<span class="nv">inv</span><span class="p">:</span><span class="nf">AgregarItem</span><span class="p">({</span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Espada&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">danio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Items: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">inv</span><span class="p">:</span><span class="nf">GetCantidad</span><span class="p">())</span>
</code></pre></div>

<hr />
<h2 id="24-optimizacion-y-buenas-practicas"><span class="num">24</span> Optimización y Buenas Prácticas</h2>
<h3 id="241-evitar-operaciones-costosas-en-thinktick">24.1. Evitar Operaciones Costosas en Think/Tick</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- MAL: Buscar entidades cada tick</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;Think&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Malo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ent</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">ents</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span><span class="w"> </span><span class="kr">end</span><span class="w">  </span><span class="c1">-- MUY caro</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- BIEN: Usar cooldowns</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">nextCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;Think&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Bueno&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">nextCheck</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">nextCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c1">-- Solo cada segundo</span>
<span class="w">    </span><span class="c1">-- lógica...</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="242-cachear-valores">24.2. Cachear Valores</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- MAL: Material() cada frame</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Malo&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetMaterial</span><span class="p">(</span><span class="nf">Material</span><span class="p">(</span><span class="s2">&quot;icon16/heart.png&quot;</span><span class="p">))</span><span class="w">  </span><span class="c1">-- No!</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- BIEN: Cachear fuera del hook</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">matCorazon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Material</span><span class="p">(</span><span class="s2">&quot;icon16/heart.png&quot;</span><span class="p">)</span>
<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Bueno&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nv">surface</span><span class="p">.</span><span class="nf">SetMaterial</span><span class="p">(</span><span class="nv">matCorazon</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="243-localizar-funciones-globales">24.3. Localizar Funciones Globales</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- En código de alto rendimiento:</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">CurTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CurTime</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">IsValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">IsValid</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">mathClamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">math</span><span class="p">.</span><span class="py">Clamp</span>
</code></pre></div>

<h3 id="244-usar-isvalid-correctamente">24.4. Usar IsValid Correctamente</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- SIEMPRE verificá antes de usar</span>
<span class="kr">if</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ent</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">ent</span><span class="p">:</span><span class="nf">SetPos</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- IsValid() global maneja nil, NULL, y entidades inválidas.</span>
<span class="c1">-- Es más seguro que ent:IsValid()</span>
</code></pre></div>

<h3 id="245-nombres-unicos-para-hooks">24.5. Nombres Únicos para Hooks</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- MAL: hook.Add(&quot;PlayerSpawn&quot;, &quot;Spawn&quot;, func)       -- Genérico, colisiona</span>
<span class="c1">-- BIEN: hook.Add(&quot;PlayerSpawn&quot;, &quot;MiAddon_Spawn&quot;, func)  -- Prefijo único</span>
</code></pre></div>

<hr />
<h2 id="25-seguridad-y-anti-exploit"><span class="num">25</span> Seguridad y Anti-Exploit</h2>
<h3 id="251-regla-de-oro-nunca-confies-en-el-cliente">25.1. Regla de Oro: Nunca Confíes en el Cliente</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- VULNERABLE:</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Tienda_Comprar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">precio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w">  </span><span class="c1">-- ¡Cliente dice el precio!</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">addMoney</span><span class="p">(</span><span class="o">-</span><span class="nv">precio</span><span class="p">)</span><span class="w">           </span><span class="c1">-- Precio negativo = dinero infinito</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- SEGURO:</span>
<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Tienda_Comprar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">itemID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ITEMS_SERVIDOR</span><span class="p">[</span><span class="nv">itemID</span><span class="p">]</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">item</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">getDarkRPVar</span><span class="p">(</span><span class="s2">&quot;money&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">item</span><span class="p">.</span><span class="py">precio</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">ply</span><span class="p">:</span><span class="nf">addMoney</span><span class="p">(</span><span class="o">-</span><span class="nv">item</span><span class="p">.</span><span class="py">precio</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="252-rate-limiting">25.2. Rate Limiting</h3>
<div class="highlight"><pre><span></span><code><span class="kd">local</span><span class="w"> </span><span class="nv">cooldowns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;MiAddon_Accion&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">cooldowns</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">cooldowns</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">cooldowns</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span>
<span class="w">    </span><span class="c1">-- Procesar...</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;MiAddon_Limpiar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">cooldowns</span><span class="p">[</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="253-validar-datos">25.3. Validar Datos</h3>
<div class="highlight"><pre><span></span><code><span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;MiAddon_SetNombre&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">nombre</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nb">type</span><span class="p">(</span><span class="nv">nombre</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="o">#</span><span class="nv">nombre</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="o">#</span><span class="nv">nombre</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">32</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="c1">-- Ahora es seguro</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="254-verificar-permisos">25.4. Verificar Permisos</h3>
<div class="highlight"><pre><span></span><code><span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Admin_Kick&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">IsAdmin</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span><span class="w">  </span><span class="c1">-- SIEMPRE verificar</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">objetivo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadEntity</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">objetivo</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">objetivo</span><span class="p">:</span><span class="nf">IsPlayer</span><span class="p">()</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>
<span class="w">    </span><span class="nv">objetivo</span><span class="p">:</span><span class="nf">Kick</span><span class="p">(</span><span class="s2">&quot;Expulsado&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="26-debugging-y-manejo-de-errores"><span class="num">26</span> Debugging y Manejo de Errores</h2>
<h3 id="261-funciones-de-debug">26.1. Funciones de Debug</h3>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hola&quot;</span><span class="p">)</span><span class="w">                    </span><span class="c1">-- Imprimir en consola</span>
<span class="nf">PrintTable</span><span class="p">(</span><span class="nv">mi_tabla</span><span class="p">)</span><span class="w">              </span><span class="c1">-- Imprimir tabla con indentación</span>
<span class="nf">MsgC</span><span class="p">(</span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Error: &quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;detalle</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nv">variable</span><span class="p">))</span><span class="w">            </span><span class="c1">-- &quot;string&quot;, &quot;number&quot;, &quot;table&quot;, etc.</span>
</code></pre></div>

<h3 id="262-manejo-de-errores">26.2. Manejo de Errores</h3>
<div class="highlight"><pre><span></span><code><span class="c1">-- pcall: atrapa errores sin detener ejecución</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">ok</span><span class="p">,</span><span class="w"> </span><span class="nv">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">pcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nf">Entity</span><span class="p">(</span><span class="mi">999999</span><span class="p">):</span><span class="nf">SetPos</span><span class="p">(</span><span class="nf">Vector</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="kr">end</span><span class="p">)</span>
<span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">ok</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">err</span><span class="p">)</span><span class="w"> </span><span class="kr">end</span>

<span class="c1">-- xpcall: con handler personalizado</span>
<span class="nb">xpcall</span><span class="p">(</span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s2">&quot;Algo falló&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">err</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nv">err</span><span class="p">)</span>
<span class="w">    </span><span class="nb">print</span><span class="p">(</span><span class="nb">debug.traceback</span><span class="p">())</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="nv">err</span>
<span class="kr">end</span><span class="p">)</span>

<span class="c1">-- ErrorNoHalt: muestra error sin detener ejecución</span>
<span class="nf">ErrorNoHalt</span><span class="p">(</span><span class="s2">&quot;Algo no está bien</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nf">ErrorNoHaltWithStack</span><span class="p">(</span><span class="s2">&quot;Con stack trace</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="263-la-libreria-debug">26.3. La Librería debug</h3>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="nb">debug.traceback</span><span class="p">())</span><span class="w">         </span><span class="c1">-- Stack trace actual</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">debug.getinfo</span><span class="p">(</span><span class="nv">func</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Info de una función</span>
<span class="nb">print</span><span class="p">(</span><span class="nv">info</span><span class="p">.</span><span class="py">source</span><span class="p">)</span><span class="w">               </span><span class="c1">-- Archivo donde se definió</span>
</code></pre></div>

<hr />
<h2 id="27-publicacion-en-el-workshop"><span class="num">27</span> Publicación en el Workshop</h2>
<h3 id="271-crear-y-subir">27.1. Crear y Subir</h3>
<p>Asegurate de tener un <code>addon.json</code> correcto. Desde la carpeta de GMod:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Crear .gma</span>
gmad.exe<span class="w"> </span>create<span class="w"> </span>-folder<span class="w"> </span><span class="s2">&quot;ruta/al/addon&quot;</span><span class="w"> </span>-out<span class="w"> </span><span class="s2">&quot;mi_addon.gma&quot;</span>

<span class="c1"># Subir (primera vez)</span>
gmpublish.exe<span class="w"> </span>create<span class="w"> </span>-addon<span class="w"> </span><span class="s2">&quot;mi_addon.gma&quot;</span><span class="w"> </span>-icon<span class="w"> </span><span class="s2">&quot;icono.jpg&quot;</span>

<span class="c1"># Actualizar</span>
gmpublish.exe<span class="w"> </span>update<span class="w"> </span>-addon<span class="w"> </span><span class="s2">&quot;mi_addon.gma&quot;</span><span class="w"> </span>-id<span class="w"> </span><span class="m">123456789</span><span class="w"> </span>-changes<span class="w"> </span><span class="s2">&quot;Descripción&quot;</span>
</code></pre></div>

<p>El ícono debe ser un <code>.jpg</code> de <strong>512x512px</strong>. También podés publicar desde el menú del juego en <strong>Main Menu → Addons → Upload</strong>.</p>
<hr />
<h2 id="28-proyecto-final-addon-completo"><span class="num">28</span> Proyecto Final: Addon Completo</h2>
<p>Para consolidar todo, este es un esqueleto completo de un <strong>sistema de recompensas por tiempo jugado</strong> que integra la mayoría de sistemas del curso.</p>
<div class="highlight"><pre><span></span><code><span class="n">addons/recompensas_tiempo/</span>
<span class="n">├── addon.json</span>
<span class="n">└── lua/</span>
<span class="n">    ├── autorun/recompensas_init.lua</span>
<span class="n">    └── recompensas/</span>
<span class="n">        ├── sh_config.lua</span>
<span class="n">        ├── sv_logica.lua</span>
<span class="n">        ├── sv_datos.lua</span>
<span class="n">        └── cl_hud.lua</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === lua/autorun/recompensas_init.lua ===</span>
<span class="nv">Recompensas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;recompensas/sh_config.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">AddCSLuaFile</span><span class="p">(</span><span class="s2">&quot;recompensas/cl_hud.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="nf">include</span><span class="p">(</span><span class="s2">&quot;recompensas/sh_config.lua&quot;</span><span class="p">)</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;recompensas/sv_datos.lua&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;recompensas/sv_logica.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">CLIENT</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nf">include</span><span class="p">(</span><span class="s2">&quot;recompensas/cl_hud.lua&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === lua/recompensas/sh_config.lua ===</span>
<span class="nv">Recompensas</span><span class="p">.</span><span class="py">Config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nv">IntervaloMinutos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">    </span><span class="nv">DineroPorIntervalo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span>
<span class="w">    </span><span class="nv">MensajeColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span>
<span class="p">}</span>

<span class="kr">if</span><span class="w"> </span><span class="nv">SERVER</span><span class="w"> </span><span class="kr">then</span>
<span class="w">    </span><span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Recompensas_Notificar&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Recompensas_PedirDatos&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">util</span><span class="p">.</span><span class="nf">AddNetworkString</span><span class="p">(</span><span class="s2">&quot;Recompensas_EnviarDatos&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === lua/recompensas/sv_datos.lua ===</span>
<span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">([[</span>
<span class="w">    </span><span class="nv">CREATE</span><span class="w"> </span><span class="nv">TABLE</span><span class="w"> </span><span class="nv">IF</span><span class="w"> </span><span class="nv">NOT</span><span class="w"> </span><span class="nv">EXISTS</span><span class="w"> </span><span class="nf">recompensas_jugadores</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nv">steamid</span><span class="w"> </span><span class="nv">TEXT</span><span class="w"> </span><span class="nv">PRIMARY</span><span class="w"> </span><span class="nv">KEY</span><span class="p">,</span>
<span class="w">        </span><span class="nv">tiempo_total</span><span class="w"> </span><span class="nv">INTEGER</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">        </span><span class="nv">recompensas_recibidas</span><span class="w"> </span><span class="nv">INTEGER</span><span class="w"> </span><span class="nv">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">]])</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Recompensas</span><span class="p">.</span><span class="nf">CargarDatos</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">SQLStr</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">())</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM recompensas_jugadores WHERE steamid = &quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">sid</span><span class="p">)</span>

<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">res</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="kr">then</span>
<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nv">tiempo_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">tonumber</span><span class="p">(</span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nv">tiempo_total</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">            </span><span class="nv">recompensas_recibidas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">tonumber</span><span class="p">(</span><span class="nv">res</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nv">recompensas_recibidas</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">0</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">&quot;INSERT INTO recompensas_jugadores (steamid) VALUES (%s)&quot;</span><span class="p">,</span><span class="w"> </span><span class="nv">sid</span><span class="p">))</span>
<span class="w">    </span><span class="kr">return</span><span class="w"> </span><span class="p">{</span><span class="nv">tiempo_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nv">recompensas_recibidas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span>
<span class="kr">end</span>

<span class="kr">function</span><span class="w"> </span><span class="nc">Recompensas</span><span class="p">.</span><span class="nf">GuardarDatos</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">datos</span><span class="p">)</span>
<span class="w">    </span><span class="nv">sql</span><span class="p">.</span><span class="nf">Query</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span>
<span class="w">        </span><span class="s2">&quot;UPDATE recompensas_jugadores SET tiempo_total = %d, recompensas_recibidas = %d WHERE steamid = %s&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nv">datos</span><span class="p">.</span><span class="py">tiempo_total</span><span class="p">,</span><span class="w"> </span><span class="nv">datos</span><span class="p">.</span><span class="py">recompensas_recibidas</span><span class="p">,</span><span class="w"> </span><span class="nv">sql</span><span class="p">.</span><span class="nf">SQLStr</span><span class="p">(</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">())</span>
<span class="w">    </span><span class="p">))</span>
<span class="kr">end</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === lua/recompensas/sv_logica.lua ===</span>
<span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">{}</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerInitialSpawn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Recompensas_Cargar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">datos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="nf">CargarDatos</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="p">[</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nv">datos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">datos</span><span class="p">,</span>
<span class="w">        </span><span class="nv">inicio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">(),</span>
<span class="w">        </span><span class="nv">ultimo_premio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;PlayerDisconnected&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Recompensas_Guardar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">sid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">tiempo_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">tiempo_total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">inicio</span><span class="p">)</span>
<span class="w">    </span><span class="nv">Recompensas</span><span class="p">.</span><span class="nf">GuardarDatos</span><span class="p">(</span><span class="nv">ply</span><span class="p">,</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">)</span>
<span class="w">    </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">nil</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">timer</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="s2">&quot;Recompensas_Chequear&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">intervalo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Config</span><span class="p">.</span><span class="py">IntervaloMinutos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">60</span>

<span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="nv">_</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nb">ipairs</span><span class="p">(</span><span class="nv">player</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">())</span><span class="w"> </span><span class="kr">do</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nf">IsValid</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">continue</span><span class="w"> </span><span class="kr">end</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">sid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()</span>
<span class="w">        </span><span class="kd">local</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="p">[</span><span class="nv">sid</span><span class="p">]</span>
<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">continue</span><span class="w"> </span><span class="kr">end</span>

<span class="w">        </span><span class="kr">if</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">ultimo_premio</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nv">intervalo</span><span class="w"> </span><span class="kr">then</span>
<span class="w">            </span><span class="nv">s</span><span class="p">.</span><span class="py">ultimo_premio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span>
<span class="w">            </span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">recompensas_recibidas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">recompensas_recibidas</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>

<span class="w">            </span><span class="c1">-- Acá darías la recompensa con tu sistema de economía</span>
<span class="w">            </span><span class="c1">-- ply:addMoney(Recompensas.Config.DineroPorIntervalo)</span>

<span class="w">            </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Recompensas_Notificar&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteUInt</span><span class="p">(</span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Config</span><span class="p">.</span><span class="py">DineroPorIntervalo</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="w">                </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteUInt</span><span class="p">(</span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">recompensas_recibidas</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="w">            </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="w">        </span><span class="kr">end</span>
<span class="w">    </span><span class="kr">end</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Recompensas_PedirDatos&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="nv">len</span><span class="p">,</span><span class="w"> </span><span class="nv">ply</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Sesiones</span><span class="p">[</span><span class="nv">ply</span><span class="p">:</span><span class="nf">SteamID64</span><span class="p">()]</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Recompensas_EnviarDatos&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteUInt</span><span class="p">(</span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">tiempo_total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">math.floor</span><span class="p">(</span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">s</span><span class="p">.</span><span class="py">inicio</span><span class="p">),</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="w">        </span><span class="nv">net</span><span class="p">.</span><span class="nf">WriteUInt</span><span class="p">(</span><span class="nv">s</span><span class="p">.</span><span class="py">datos</span><span class="p">.</span><span class="py">recompensas_recibidas</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Send</span><span class="p">(</span><span class="nv">ply</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="c1">-- === lua/recompensas/cl_hud.lua ===</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">mostrarNotif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">notifTiempo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="kd">local</span><span class="w"> </span><span class="nv">notifDinero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>

<span class="nv">net</span><span class="p">.</span><span class="nf">Receive</span><span class="p">(</span><span class="s2">&quot;Recompensas_Notificar&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nv">notifDinero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadUInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">net</span><span class="p">.</span><span class="nf">ReadUInt</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="w">    </span><span class="nv">mostrarNotif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nv">notifTiempo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span>

<span class="w">    </span><span class="nv">chat</span><span class="p">.</span><span class="nf">AddText</span><span class="p">(</span>
<span class="w">        </span><span class="nv">Recompensas</span><span class="p">.</span><span class="py">Config</span><span class="p">.</span><span class="py">MensajeColor</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;[Recompensas] &quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;Recibiste $&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">notifDinero</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="s2">&quot; por jugar&quot;</span>
<span class="w">    </span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;InitPostEntity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Recompensas_Pedir&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">Start</span><span class="p">(</span><span class="s2">&quot;Recompensas_PedirDatos&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nv">net</span><span class="p">.</span><span class="nf">SendToServer</span><span class="p">()</span>
<span class="kr">end</span><span class="p">)</span>

<span class="nv">hook</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s2">&quot;HUDPaint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Recompensas_Notif&quot;</span><span class="p">,</span><span class="w"> </span><span class="kr">function</span><span class="p">()</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nv">mostrarNotif</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">elapsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">CurTime</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nv">notifTiempo</span>
<span class="w">    </span><span class="kd">local</span><span class="w"> </span><span class="nv">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">elapsed</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nv">math</span><span class="p">.</span><span class="nf">Clamp</span><span class="p">(</span><span class="mi">255</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nv">elapsed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="mi">255</span>
<span class="w">    </span><span class="kr">if</span><span class="w"> </span><span class="nv">alpha</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="kr">then</span><span class="w"> </span><span class="nv">mostrarNotif</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="kr">return</span><span class="w"> </span><span class="kr">end</span>

<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">RoundedBox</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="nf">ScrW</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">alpha</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.7</span><span class="p">))</span>
<span class="w">    </span><span class="nv">draw</span><span class="p">.</span><span class="nf">SimpleText</span><span class="p">(</span><span class="s2">&quot;+$&quot;</span><span class="w"> </span><span class="o">..</span><span class="w"> </span><span class="nv">notifDinero</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DermaLarge&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nf">ScrW</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">225</span><span class="p">,</span><span class="w"> </span><span class="nf">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">alpha</span><span class="p">),</span>
<span class="w">        </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">,</span><span class="w"> </span><span class="nv">TEXT_ALIGN_CENTER</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</code></pre></div>

<hr />
<h2 id="cierre-y-recursos">Cierre y Recursos</h2>
<p>Si llegaste hasta acá, ya tenés los conocimientos necesarios para desarrollar addons completos para Garry's Mod. Los temas cubiertos abarcan la gran mayoría de lo que necesitás para proyectos reales.</p>
<h3 id="recursos-adicionales">Recursos Adicionales</h3>
<ul>
<li><strong>Wiki Oficial:</strong> <a href="https://wiki.facepunch.com/gmod/">wiki.facepunch.com/gmod</a> — la referencia definitiva</li>
<li><strong>GitHub del código Lua de GMod:</strong> <a href="https://github.com/Facepunch/garrysmod">github.com/Facepunch/garrysmod</a></li>
<li><strong>Discord Oficial:</strong> <a href="https://discord.gg/gmod">discord.gg/gmod</a></li>
<li><strong>Changelogs:</strong> <a href="https://gmod.facepunch.com/news">gmod.facepunch.com/news</a></li>
<li><strong>Manual Lua 5.1:</strong> <a href="http://www.lua.org/manual/5.1/manual.html">lua.org/manual/5.1/manual.html</a></li>
</ul>
<h3 id="consejos-finales">Consejos Finales</h3>
<p>Leé código de addons existentes — es una de las mejores formas de aprender patrones reales. Siempre consultá la wiki oficial ante la duda; este curso te da los cimientos, pero la wiki tiene documentación detallada de cada función, cada hook, y cada panel disponible. Experimentá, rompé cosas, y sobre todo — divertite programando.</p>

</main>

<button class="btt" id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})">↑</button>

<script>
window.addEventListener('scroll',()=>{
  const h=document.documentElement;
  const p=(h.scrollTop/(h.scrollHeight-h.clientHeight))*100;
  document.getElementById('prog').style.width=p+'%';
  document.getElementById('btt').classList.toggle('show',h.scrollTop>400);
});
document.querySelectorAll('.sb-nav a').forEach(a=>{
  a.addEventListener('click',()=>{
    if(window.innerWidth<=900)document.getElementById('sb').classList.remove('open');
  });
});
</script>
</body>
</html>